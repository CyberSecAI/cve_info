{
  "cveId": "CVE-2022-48839",
  "version": "1.0.0",
  "timestamp": "2024-12-19T22:22:49.126128+00:00",
  "description": "In the Linux kernel, the following vulnerability has been resolvednet/packet fix slab-out-of-bounds access in packet_recvmsg()syzbot found that when an AF_PACKET socket is using PACKET_COPY_THRESHand mmap operations, tpacket_rcv() is queueing skbs withgarbage in skb->cb[], triggering a too big copy [1]Presumably, users of af_packet using mmap() already gets correctmetadata from the mapped buffer, we can simply make sureto clear 12 bytes that might be copied to user space later.BUG KASAN stack-out-of-bounds in memcpy include/linux/fortify-string.h225 [inline]BUG KASAN stack-out-of-bounds in packet_recvmsg+0x56c/0x1150 net/packet/af_packet.c3489Write of size 165 at addr ffffc9000385fb78 by task syz-executor233/3631CPU 0 PID 3631 Comm syz-executor233 Not tainted 5.17.0-rc7-syzkaller-02396-g0b3660695e80 #0Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011Call Trace __dump_stack lib/dump_stack.c88 [inline] dump_stack_lvl+0xcd/0x134 lib/dump_stack.c106 print_address_description.constprop.0.cold+0xf/0x336 mm/kasan/report.c255 __kasan_report mm/kasan/report.c442 [inline] kasan_report.cold+0x83/0xdf mm/kasan/report.c459 check_region_inline mm/kasan/generic.c183 [inline] kasan_check_range+0x13d/0x180 mm/kasan/generic.c189 memcpy+0x39/0x60 mm/kasan/shadow.c66 memcpy include/linux/fortify-string.h225 [inline] packet_recvmsg+0x56c/0x1150 net/packet/af_packet.c3489 sock_recvmsg_nosec net/socket.c948 [inline] sock_recvmsg net/socket.c966 [inline] sock_recvmsg net/socket.c962 [inline] ____sys_recvmsg+0x2c4/0x600 net/socket.c2632 ___sys_recvmsg+0x127/0x200 net/socket.c2674 __sys_recvmsg+0xe2/0x1a0 net/socket.c2704 do_syscall_x64 arch/x86/entry/common.c50 [inline] do_syscall_64+0x35/0xb0 arch/x86/entry/common.c80 entry_SYSCALL_64_after_hwframe+0x44/0xaeRIP 00330x7fdfd5954c29Code 28 00 00 00 75 05 48 83 c4 28 c3 e8 41 15 00 00 90 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 3d 01 f0 ff ff 73 01 c3 48 c7 c1 c0 ff ff ff f7 d8 64 89 01 48RSP 002b00007ffcf8e71e48 EFLAGS 00000246 ORIG_RAX 000000000000002fRAX ffffffffffffffda RBX 0000000000000003 RCX 00007fdfd5954c29RDX 0000000000000000 RSI 0000000020000500 RDI 0000000000000005RBP 0000000000000000 R08 000000000000000d R09 000000000000000dR10 0000000000000000 R11 0000000000000246 R12 00007ffcf8e71e60R13 00000000000f4240 R14 000000000000c1ff R15 00007ffcf8e71e54 addr ffffc9000385fb78 is located in stack of task syz-executor233/3631 at offset 32 in frame ____sys_recvmsg+0x0/0x600 include/linux/uio.h246this frame has 1 object [32, 160) addrMemory state around the buggy address ffffc9000385fa80 00 04 f3 f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 ffffc9000385fb00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 00>ffffc9000385fb80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f3 ^ ffffc9000385fc00 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00 f1 ffffc9000385fc80 f1 f1 f1 00 f2 f2 f2 00 f2 f2 f2 00 00 00 00 00==================================================================",
  "keyphrases": {
    "rootcause": [
      "The vulnerability is caused by the `tpacket_rcv()` function queueing skbs with garbage in skb->cb[]",
      "leading to an out-of-bounds access in `packet_recvmsg()` when using PACKET_COPY_THRESH and mmap operations with AF_PACKET sockets."
    ],
    "weakness": [
      "The `tpacket_rcv()` function does not properly clear the `skb->cb` before queueing the skb",
      "slab-out-of-bounds",
      "which allows garbage data to be copied to user space."
    ],
    "impact": [
      "An attacker can cause a kernel stack-out-of-bounds write",
      "potentially leading to privilege escalation",
      "denial of service",
      "or arbitrary code execution."
    ],
    "vector": [
      "The vulnerability is triggered via a crafted AF_PACKET socket using `PACKET_COPY_THRESH` and mmap operations",
      "which leads to the vulnerable code path in `packet_recvmsg`."
    ],
    "attacker": "An attacker with the ability to create and manipulate AF_PACKET sockets can exploit this vulnerability.",
    "product": "Linux Kernel",
    "version": "5.17.0-rc7",
    "component": "net/packet"
  },
  "mitreTechnicalImpacts": []
}