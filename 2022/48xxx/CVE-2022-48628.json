{
    "cveId": "CVE-2022-48628",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedceph drop messages from MDS when unmountingWhen unmounting all the dirty buffers will be flushed and afterthe last osd request is finished the last reference of the i_countwill be released. Then it will flush the dirty cap/snap to MDSs,and the unmounting wont wait the possible acks, which will iholdthe inodes when updating the metadata locally but makes no senseany more, of this. This will make the evict_inodes() to skip theseinodes.If encrypt is enabled the kernel generate a warning when removingthe encrypt keys when the skipped inodes still hold the keyringWARNING CPU 4 PID 168846 at fs/crypto/keyring.c242 fscrypt_destroy_keyring+0x7e/0xd0CPU 4 PID 168846 Comm umount Tainted G S 6.1.0-rc5-ceph-g72ead199864c #1Hardware name Supermicro SYS-5018R-WR/X10SRW-F, BIOS 2.0 12/17/2015RIP 0010fscrypt_destroy_keyring+0x7e/0xd0RSP 0018ffffc9000b277e28 EFLAGS 00010202RAX 0000000000000002 RBX ffff88810d52ac00 RCX ffff88810b56aa00RDX 0000000080000000 RSI ffffffff822f3a09 RDI ffff888108f59000RBP ffff8881d394fb88 R08 0000000000000028 R09 0000000000000000R10 0000000000000001 R11 11ff4fe6834fcd91 R12 ffff8881d394fc40R13 ffff888108f59000 R14 ffff8881d394f800 R15 0000000000000000FS 00007fd83f6f1080(0000) GSffff88885fd00000(0000) knlGS0000000000000000CS 0010 DS 0000 ES 0000 CR0 0000000080050033CR2 00007f918d417000 CR3 000000017f89a005 CR4 00000000003706e0DR0 0000000000000000 DR1 0000000000000000 DR2 0000000000000000DR3 0000000000000000 DR6 00000000fffe0ff0 DR7 0000000000000400Call Tracegeneric_shutdown_super+0x47/0x120kill_anon_super+0x14/0x30ceph_kill_sb+0x36/0x90 [ceph]deactivate_locked_super+0x29/0x60cleanup_mnt+0xb8/0x140task_work_run+0x67/0xb0exit_to_user_mode_prepare+0x23d/0x240syscall_exit_to_user_mode+0x25/0x60do_syscall_64+0x40/0x80entry_SYSCALL_64_after_hwframe+0x63/0xcdRIP 00330x7fd83dc39e9bLater the kernel will crash when iput() the inodes and dereferencingthe sb->s_master_keys, which has been released by thegeneric_shutdown_super().",
    "keyphrases": {
        "rootcause": "The unmounting process doesn't wait for acknowledgements after flushing dirty cap/snap to MDSs, leading to premature inode release and subsequent issues.",
        "weakness": "Lack of proper synchronization during unmount, specifically not waiting for MDS acknowledgements before releasing inode references.",
        "impact": "Kernel warning during key removal and kernel crash when dereferencing a released superblock member.",
        "vector": "Unmounting a Ceph filesystem with encryption enabled.",
        "attacker": "Local user with the ability to unmount the filesystem.",
        "product": "Linux Kernel",
        "version": "6.1.0-rc5-ceph-g72ead199864c",
        "component": "Ceph Filesystem"
    }
}
