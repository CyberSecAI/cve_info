{
    "cveId": "CVE-2022-48848",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedtracing/osnoise Do not unregister events twiceNicolas reported that using # trace-cmd record -e all -M 10 -p osnoise --pollResulted in the following kernel warning ------------[ cut here ]------------ WARNING CPU 0 PID 1217 at kernel/tracepoint.c404 tracepoint_probe_unregister+0x280/0x370 [...] CPU 0 PID 1217 Comm trace-cmd Not tainted 5.17.0-rc6-next-20220307-nico+ #19 RIP 0010tracepoint_probe_unregister+0x280/0x370 [...] CR2 00007ff919b29497 CR3 0000000109da4005 CR4 0000000000170ef0 Call Trace osnoise_workload_stop+0x36/0x90 tracing_set_tracer+0x108/0x260 tracing_set_trace_write+0x94/0xd0 ? __check_object_size.part.0+0x10a/0x150 ? selinux_file_permission+0x104/0x150 vfs_write+0xb5/0x290 ksys_write+0x5f/0xe0 do_syscall_64+0x3b/0x90 entry_SYSCALL_64_after_hwframe+0x44/0xae RIP 00330x7ff919a18127 [...] ---[ end trace 0000000000000000 ]---The warning complains about an attempt to unregister anunregistered tracepoint.This happens on trace-cmd because it first stops tracing, andthen switches the tracer to nop. Which is equivalent to # cd /sys/kernel/tracing/ # echo osnoise > current_tracer # echo 0 > tracing_on # echo nop > current_tracerThe osnoise tracer stops the workload when no trace instanceis actually collecting data. This can be caused both bydisabling tracing or disabling the tracer itself.To avoid unregistering events twice, use the existingtrace_osnoise_callback_enabled variable to check if the events(and the workload) are actually active before trying todeactivate them.",
    "keyphrases": {
        "rootcause": "The osnoise tracer attempts to unregister tracepoints that are already unregistered when tracing is stopped or the tracer is switched to 'nop'.",
        "weakness": "The tracer doesn't check if events are active before trying to deactivate them, leading to double unregistration.",
        "impact": "Kernel warning and potential instability due to incorrect tracepoint management.",
        "vector": "Triggered by disabling tracing or switching the tracer to 'nop' after using the osnoise tracer.",
        "attacker": "trace-cmd tool",
        "product": "Linux Kernel",
        "version": "5.17.0-rc6-next-20220307-nico",
        "component": "tracing/osnoise"
    }
}
