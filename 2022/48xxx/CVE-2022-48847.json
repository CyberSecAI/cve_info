{
  "cveId": "CVE-2022-48847",
  "version": "1.0.0",
  "timestamp": "2024-12-19T22:22:49.126128+00:00",
  "description": "In the Linux kernel, the following vulnerability has been resolvedwatch_queue Fix filter limit checkIn watch_queue_set_filter(), there are a couple of places where we checkthat the filter type value does not exceed what the type_filter bitmapcan hold. One place calculates the number of bits by if (tf[i].type >= sizeof(wfilter->type_filter) * 8)which is fine, but the second does if (tf[i].type >= sizeof(wfilter->type_filter) * BITS_PER_LONG)which is not. This can lead to a couple of out-of-bounds writes due toa too-large type (1) __set_bit() on wfilter->type_filter (2) Writing more elements in wfilter->filters[] than we allocated.Fix this by just using the proper WATCH_TYPE__NR instead, which is thenumber of types we actually know about.The bug may cause an oops looking something like BUG KASAN slab-out-of-bounds in watch_queue_set_filter+0x659/0x740 Write of size 4 at addr ffff88800d2c66bc by task watch_queue_oob/611 ... Call Trace dump_stack_lvl+0x45/0x59 print_address_description.constprop.0+0x1f/0x150 ... kasan_report.cold+0x7f/0x11b ... watch_queue_set_filter+0x659/0x740 ... __x64_sys_ioctl+0x127/0x190 do_syscall_64+0x43/0x90 entry_SYSCALL_64_after_hwframe+0x44/0xae Allocated by task 611 kasan_save_stack+0x1e/0x40 __kasan_kmalloc+0x81/0xa0 watch_queue_set_filter+0x23a/0x740 __x64_sys_ioctl+0x127/0x190 do_syscall_64+0x43/0x90 entry_SYSCALL_64_after_hwframe+0x44/0xae The buggy address belongs to the object at ffff88800d2c66a0 which belongs to the cache kmalloc-32 of size 32 The buggy address is located 28 bytes inside of 32-byte region [ffff88800d2c66a0, ffff88800d2c66c0)",
  "keyphrases": {
    "rootcause": [
      "The filter type value check in watch_queue_set_filter() uses an incorrect calculation",
      "leading to out-of-bounds writes."
    ],
    "weakness": [
      "Incorrect bounds check in watch_queue_set_filter() when setting filter type.",
      "out-of-bounds writes",
      "slab-out-of-bounds"
    ],
    "impact": [
      "Out-of-bounds writes can occur in the kernel memory",
      "oops",
      "potentially leading to a system crash or other unpredictable behavior."
    ],
    "vector": "An attacker could exploit this vulnerability through an ioctl call to watch_queue_set_filter() with a crafted filter type value.",
    "attacker": "An attacker with the ability to call the ioctl system call.",
    "product": "Linux Kernel",
    "version": "Affected versions are prior to the fix",
    "component": "watch_queue"
  },
  "mitreTechnicalImpacts": []
}