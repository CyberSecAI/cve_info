{
  "cveId": "CVE-2022-49003",
  "version": "1.0.0",
  "timestamp": "2024-12-06T11:32:07.789868+00:00",
  "description": "In the Linux kernel, the following vulnerability has been resolved nvme fix SRCU protection of nvme_ns_head list Walking the nvme_ns_head siblings list is protected by the heads srcu in nvme_ns_head_submit_bio() but not nvme_mpath_revalidate_paths(). Removing namespaces from the list also fails to synchronize the srcu. Concurrent scan work can therefore cause use-after-frees. Hold the heads srcu lock in nvme_mpath_revalidate_paths() and synchronize with the srcu, not the global RCU, in nvme_ns_remove(). Observed the following panic when making NVMe/RDMA connections with native multipath on the Rocky Linux 8.6 kernel (it seems the upstream kernel has the same race condition). Disassembly shows the faulting instruction is cmp 0x50(%rdx),%rcx computing capacity != get_capacity(ns->disk). Address 0x50 is dereferenced because ns->disk is NULL. The NULL disk appears to be the result of concurrent scan work freeing the namespace (note the log line in the middle of the panic). [37314.206036] BUG unable to handle kernel NULL pointer dereference at 0000000000000050 [37314.206036] nvme0n3 detected capacity change from 0 to 11811160064 [37314.299753] PGD 0 P4D 0 [37314.299756] Oops 0000 [#1] SMP PTI [37314.299759] CPU 29 PID 322046 Comm kworker/u983 Kdump loaded Tainted G W X --------- - - 4.18.0-372.32.1.el8test86.x86_64 #1 [37314.299762] Hardware name Dell Inc. PowerEdge R720/0JP31P, BIOS 2.7.0 05/23/2018 [37314.299763] Workqueue nvme-wq nvme_scan_work",
  "keyphrases": {
    "rootcause": [
      "UAF due to inconsistent srcu protection",
      "race condition"
    ],
    "weakness": "use-after-free",
    "impact": [
      "Oops",
      "panic"
    ],
    "vector": "concurrent scan work",
    "attacker": "",
    "product": "Linux kernel",
    "version": "",
    "component": "nvme_ns_head list"
  },
  "mitreTechnicalImpacts": []
}