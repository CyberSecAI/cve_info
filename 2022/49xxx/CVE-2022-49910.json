{
    "cveId": "CVE-2022-49910",
    "version": "1.0.0",
    "timestamp": "2025-07-04T16:12:41.853043+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved Bluetooth L2CAP Fix use-after-free caused by l2cap_reassemble_sdu Fix the race condition between the following two flows that run in parallel 1. l2cap_reassemble_sdu -> chan->ops->recv (l2cap_sock_recv_cb) -> __sock_queue_rcv_skb. 2. bt_sock_recvmsg -> skb_recv_datagram, skb_free_datagram. An SKB can be queued by the first flow and immediately dequeued and freed by the second flow, therefore the callers of l2cap_reassemble_sdu cant use the SKB after that function returns. However, some places continue accessing struct l2cap_ctrl that resides in the SKBs CB for a short time after l2cap_reassemble_sdu returns, leading to a use-after-free condition (the stack trace is below, line numbers for kernel 5.19.8). Fix it by keeping a local copy of struct l2cap_ctrl. BUG KASAN use-after-free in l2cap_rx_state_recv (net/bluetooth/l2cap_core.c6906) bluetooth Read of size 1 at addr ffff88812025f2f0 by task kworker/u173/43169 Workqueue hci0 hci_rx_work [bluetooth] Call Trace dump_stack_lvl (lib/dump_stack.c107 (discriminator 4)) print_report.cold (mm/kasan/report.c314 mm/kasan/report.c429) ? l2cap_rx_state_recv (net/bluetooth/l2cap_core.c6906) bluetooth kasan_report (mm/kasan/report.c162 mm/kasan/report.c493) ? l2cap_rx_state_recv (net/bluetooth/l2cap_core.c6906) bluetooth l2cap_rx_state_recv (net/bluetooth/l2cap_core.c6906) bluetooth l2cap_rx (net/bluetooth/l2cap_core.c7236 net/bluetooth/l2cap_core.c7271) bluetooth ret_from_fork (arch/x86/entry/entry_64.S306) Allocated by task 43169 kasan_save_stack (mm/kasan/common.c39) __kasan_slab_alloc (mm/kasan/common.c45 mm/kasan/common.c436 mm/kasan/common.c469) kmem_cache_alloc_node (mm/slab.h750 mm/slub.c3243 mm/slub.c3293) __alloc_skb (net/core/skbuff.c414) l2cap_recv_frag (./include/net/bluetooth/bluetooth.h425 net/bluetooth/l2cap_core.c8329) bluetooth l2cap_recv_acldata (net/bluetooth/l2cap_core.c8442) bluetooth hci_rx_work (net/bluetooth/hci_core.c3642 net/bluetooth/hci_core.c3832) bluetooth process_one_work (kernel/workqueue.c2289) worker_thread (./include/linux/list.h292 kernel/workqueue.c2437) kthread (kernel/kthread.c376) ret_from_fork (arch/x86/entry/entry_64.S306) Freed by task 27920 kasan_save_stack (mm/kasan/common.c39) kasan_set_track (mm/kasan/common.c45) kasan_set_free_info (mm/kasan/generic.c372) ____kasan_slab_free (mm/kasan/common.c368 mm/kasan/common.c328) slab_free_freelist_hook (mm/slub.c1780) kmem_cache_free (mm/slub.c3536 mm/slub.c3553) skb_free_datagram (./include/net/sock.h1578 ./include/net/sock.h1639 net/core/datagram.c323) bt_sock_recvmsg (net/bluetooth/af_bluetooth.c295) bluetooth l2cap_sock_recvmsg (net/bluetooth/l2cap_sock.c1212) bluetooth sock_read_iter (net/socket.c1087) new_sync_read (./include/linux/fs.h2052 fs/read_write.c401) vfs_read (fs/read_write.c482) ksys_read (fs/read_write.c620) do_syscall_64 (arch/x86/entry/common.c50 arch/x86/entry/common.c80) entry_SYSCALL_64_after_hwframe (arch/x86/entry/entry_64.S120)",
    "keyphrases": {
        "rootcause": "race condition",
        "weakness": "use-after-free",
        "impact": "",
        "vector": "",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": "Bluetooth L2CAP"
    }
}
