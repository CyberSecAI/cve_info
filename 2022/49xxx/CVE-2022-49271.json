{
    "cveId": "CVE-2022-49271",
    "version": "1.0.0",
    "timestamp": "2025-07-04T16:12:41.853043+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved cifs prevent bad output lengths in smb2_ioctl_query_info() When calling smb2_ioctl_query_info() with smb_query_infoflags=PASSTHRU_FSCTL and smb_query_infooutput_buffer_length=0, the following would return 0x10 buffer = memdup_user(arg + sizeof(struct smb_query_info), qi.output_buffer_length) if (IS_ERR(buffer)) { kfree(vars) return PTR_ERR(buffer) } rather than a valid pointer thus making IS_ERR() check fail. This would then cause a NULL ptr deference in @buffer when accessing it later in smb2_ioctl_query_ioctl(). While at it, prevent having a @buffer smaller than 8 bytes to correctly handle SMB2_SET_INFO FileEndOfFileInformation requests when smb_query_infoflags=PASSTHRU_SET_INFO. Here is a small C reproducer which triggers a NULL ptr in @buffer when passing an invalid smb_query_infoflags #include #include #include #include #include #include #define die(s) perror(s), exit(1) #define QUERY_INFO 0xc018cf07 int main(int argc, char *argv[]) { int fd if (argc 3c 02 00 0f 85 9c 01 00 00 49 8b 3f e8 58 02 fb ff 48 8b 14 24 [ 114.142348] RSP 0018ffffc90000b47b00 EFLAGS 00010256 [ 114.142692] RAX dffffc0000000000 RBX ffff888115503200 RCX ffffffffa020580d [ 114.143119] RDX 0000000000000000 RSI 0000000000000004 RDI ffffffffa043a380 [ 114.143544] RBP ffff888115503278 R08 0000000000000001 R09 0000000000000003 [ 114.143983] R10 fffffbfff4087470 R11 0000000000000001 R12 ffff888115503288 [ 114.144424] R13 00000000ffffffea R14 ffff888115503228 R15 0000000000000000 [ 114.144852] FS 00007f7aeabdf740(0000) GSffff888151600000(0000) knlGS0000000000000000 [ 114.145338] CS 0010 DS 0000 ES 0000 CR0 0000000080050033 [ 114.145692] CR2 00007f7aeacfdf5e CR3 000000012000e000 CR4 0000000000350ee0 [ 114.146131] Call Trace [ 114.146291] [ 114.146432] ? smb2_query_reparse_tag+0x890/0x890 [cifs] [ 114.146800] ? cifs_mapchar+0x460/0x460 [cifs] [ 114.147121] ? rcu_read_lock_sched_held+0x3f/0x70 [ 114.147412] ? cifs_strndup_to_utf16+0x15b/0x250 [cifs] [ 114.147775] ? dentry_path_raw+0xa6/0xf0 [ 114.148024] ? cifs_convert_path_to_utf16+0x198/0x220 [cifs] [ 114.148413] ? smb2_check_message+0x1080/0x1080 [cifs] [ 114.148766] ? rcu_read_lock_sched_held+0x3f/0x70 [ 114.149065] cifs_ioctl+0x1577/0x3320 [cifs] [ 114.149371] ? lock_downgrade+0x6f0/0x6f0 [ 114.149631] ? cifs_readdir+0x2e60/0x2e60 [cifs] [ 114.149956] ? rcu_read_lock_sched_held+0x3f/0x70 [ 114.150250] ? __rseq_handle_notify_resume+0x80b/0xbe0 [ 114.150562] ? __up_read+0x192/0x710 [ 114.150791] ? __ia32_sys_rseq+0xf0/0xf0 [ 114.151025] ? __x64_sys_openat+0x11f/0x1d0 [ 114.151296] __x64_sys_ioctl+0x127/0x190 [ 114.151549] do_syscall_64+0x3b/0x90 [ 114.151768] entry_SYSCALL_64_after_hwframe+0x44/0xae [ 114.152079] RIP 00330x7f7aead043df [ 114.152306] Code 00 48 89 44 24 18 31 c0 48 8d 44 24 60 c7 04 24 ---truncated---",
    "keyphrases": {
        "rootcause": "NULL ptr deference",
        "weakness": "NULL pointer dereference",
        "impact": "",
        "vector": "",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": "smb2_ioctl_query_info()"
    }
}
