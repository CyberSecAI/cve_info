{
    "cveId": "CVE-2023-52621",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedbpf Check rcu_read_lock_trace_held() before calling bpf map helpersThese three bpf_map_{lookup,update,delete}_elem() helpers are alsoavailable for sleepable bpf program, so add the corresponding lockassertion for sleepable bpf program, otherwise the following warningwill be reported when a sleepable bpf program manipulates bpf map underinterpreter mode (aka bpf_jit_enable=0) WARNING CPU 3 PID 4985 at kernel/bpf/helpers.c40 ...... CPU 3 PID 4985 Comm test_progs Not tainted 6.6.0+ #2 Hardware name QEMU Standard PC (i440FX + PIIX, 1996) ...... RIP 0010bpf_map_lookup_elem+0x54/0x60 ...... Call Trace ? __warn+0xa5/0x240 ? bpf_map_lookup_elem+0x54/0x60 ? report_bug+0x1ba/0x1f0 ? handle_bug+0x40/0x80 ? exc_invalid_op+0x18/0x50 ? asm_exc_invalid_op+0x1b/0x20 ? __pfx_bpf_map_lookup_elem+0x10/0x10 ? rcu_lockdep_current_cpu_online+0x65/0xb0 ? rcu_is_watching+0x23/0x50 ? bpf_map_lookup_elem+0x54/0x60 ? __pfx_bpf_map_lookup_elem+0x10/0x10 ___bpf_prog_run+0x513/0x3b70 __bpf_prog_run32+0x9d/0xd0 ? __bpf_prog_enter_sleepable_recur+0xad/0x120 ? __bpf_prog_enter_sleepable_recur+0x3e/0x120 bpf_trampoline_6442580665+0x4d/0x1000 __x64_sys_getpgid+0x5/0x30 ? do_syscall_64+0x36/0xb0 entry_SYSCALL_64_after_hwframe+0x6e/0x76",
    "keyphrases": {
        "rootcause": "The bpf_map_lookup_elem, bpf_map_update_elem, and bpf_map_delete_elem helpers did not have the rcu_read_lock_trace_held() check for sleepable bpf programs, leading to potential race conditions when manipulating bpf maps under interpreter mode.",
        "weakness": "Missing lock assertion for sleepable bpf programs when using bpf map helpers.",
        "impact": "A race condition can occur when a sleepable bpf program manipulates a bpf map under interpreter mode (bpf_jit_enable=0), potentially leading to a kernel warning and unpredictable behavior.",
        "vector": "The vulnerability is triggered when a sleepable BPF program calls bpf_map_lookup_elem, bpf_map_update_elem, or bpf_map_delete_elem while the interpreter mode is enabled (bpf_jit_enable=0).",
        "attacker": "A local attacker could trigger this vulnerability by running a crafted sleepable BPF program.",
        "product": "Linux Kernel",
        "version": "Versions prior to the fix (e.g., 6.6.0+)",
        "component": "BPF subsystem"
    }
}
