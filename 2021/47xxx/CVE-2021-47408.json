{
    "cveId": "CVE-2021-47408",
    "version": "1.0.0",
    "timestamp": "2024-12-06T11:32:07.789868+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved netfilter conntrack serialize hash resizes and cleanups Syzbot was able to trigger the following warning [1] No repro found by syzbot yet but I was able to trigger similar issue by having 2 scripts running in parallel, changing conntrack hash sizes, and for j in `seq 1 1000` do unshare -n /bin/true >/dev/null done It would take more than 5 minutes for net_namespace structures to be cleaned up. This is because nf_ct_iterate_cleanup() has to restart everytime a resize happened. By adding a mutex, we can serialize hash resizes and cleanups and also make get_next_corpse() faster by skipping over empty buckets. Even without resizes in the picture, this patch considerably speeds up network namespace dismantles. [1] INFO task syz-executor.08312 cant die for more than 144 seconds. tasksyz-executor.0 stateR running task stack25672 pid 8312 ppid 6573 flags0x00004006 Call Trace context_switch kernel/sched/core.c4955 [inline] __schedule+0x940/0x26f0 kernel/sched/core.c6236 preempt_schedule_common+0x45/0xc0 kernel/sched/core.c6408 preempt_schedule_thunk+0x16/0x18 arch/x86/entry/thunk_64.S35 __local_bh_enable_ip+0x109/0x120 kernel/softirq.c390 local_bh_enable include/linux/bottom_half.h32 [inline] get_next_corpse net/netfilter/nf_conntrack_core.c2252 [inline] nf_ct_iterate_cleanup+0x15a/0x450 net/netfilter/nf_conntrack_core.c2275 nf_conntrack_cleanup_net_list+0x14c/0x4f0 ne"
}
