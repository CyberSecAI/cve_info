{
  "cveId": "CVE-2021-47563",
  "version": "1.0.0",
  "timestamp": "2024-12-06T11:32:07.789868+00:00",
  "description": "In the Linux kernel, the following vulnerability has been resolved ice avoid bpf_prog refcount underflow Ice driver has the routines for managing XDP resources that are shared between ndo_bpf op and VSI rebuild flow. The latter takes place for example when user changes queue count on an interface via ethtools set_channels(). There is an issue around the bpf_prog refcounting when VSI is being rebuilt - since ice_prepare_xdp_rings() is called with vsi->xdp_prog as an argument that is used later on by ice_vsi_assign_bpf_prog(), same bpf_prog pointers are swapped with each other. Then it is also interpreted as an old_prog which in turn causes us to call bpf_prog_put on it that will decrement its refcount. Below splat can be interpreted in a way that due to zero refcount of a bpf_prog it is wiped out from the system while kernel still tries to refer to it [ 481.069429] BUG unable to handle page fault for address ffffc9000640f038 [ 481.077390] #PF supervisor read access in kernel mode [ 481.083335] #PF error_code(0x0000) - not-present page [ 481.089276] PGD 100000067 P4D 100000067 PUD 1001cb067 PMD 106d2b067 PTE 0 [ 481.097141] Oops 0000 [#1] PREEMPT SMP PTI [ 481.101980] CPU 12 PID 3339 Comm sudo Tainted G OE 5.15.0-rc5+ #1 [ 481.110840] Hardware name Intel Corp. GRANTLEY/GRANTLEY, BIOS GRRFCRB1.86B.0276.D07.1605190235 05/19/2016 [ 481.122021] RIP 0010dev_xdp_prog_id+0x25/0x40 [ 481.127265] Code 80 00 00 00 00 0f 1f 44 00 00 89 f6 48",
  "keyphrases": {
    "rootcause": "improper bpf_prog refcounting",
    "weakness": "",
    "impact": [
      "Oops",
      "kernel panic",
      "read access"
    ],
    "vector": "VSI rebuild flow",
    "attacker": "",
    "product": "Linux kernel",
    "version": "",
    "component": "Ice driver"
  },
  "mitreTechnicalImpacts": []
}