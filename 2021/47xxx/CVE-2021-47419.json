{
    "cveId": "CVE-2021-47419",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvednet/sched sch_taprio properly cancel timer from taprio_destroy()There is a comment in qdisc_create() about us not calling ops->reset()in some cases.err_out4 /* * Any broken qdiscs that would require a ops->reset() here? * The qdisc was never in action so it shouldnt be necessary. */As taprio sets a timer before actually receiving a packet, we needto cancel it from ops->destroy, just in case ops->reset has notbeen called.syzbot reportedODEBUG free active (active state 0) object type hrtimer hint advance_sched+0x0/0x9a0 arch/x86/include/asm/atomic64_64.h22WARNING CPU 0 PID 8441 at lib/debugobjects.c505 debug_print_object+0x16e/0x250 lib/debugobjects.c505Modules linked inCPU 0 PID 8441 Comm syz-executor813 Not tainted 5.14.0-rc6-syzkaller #0Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011RIP 0010debug_print_object+0x16e/0x250 lib/debugobjects.c505Code ff df 48 89 fa 48 c1 ea 03 80 3c 02 00 0f 85 af 00 00 00 48 8b 14 dd e0 d3 e3 89 4c 89 ee 48 c7 c7 e0 c7 e3 89 e8 5b 86 11 05 0b 83 05 85 03 92 09 01 48 83 c4 18 5b 5d 41 5c 41 5d 41 5e c3RSP 0018ffffc9000130f330 EFLAGS 00010282RAX 0000000000000000 RBX 0000000000000003 RCX 0000000000000000RDX ffff88802baeb880 RSI ffffffff815d87b5 RDI fffff52000261e58RBP 0000000000000001 R08 0000000000000000 R09 0000000000000000R10 ffffffff815d25ee R11 0000000000000000 R12 ffffffff898dd020R13 ffffffff89e3ce20 R14 ffffffff81653630 R15 dffffc0000000000FS 0000000000f0d300(0000) GSffff8880b9d00000(0000) knlGS0000000000000000CS 0010 DS 0000 ES 0000 CR0 0000000080050033CR2 00007ffb64b3e000 CR3 0000000036557000 CR4 00000000001506e0DR0 0000000000000000 DR1 0000000000000000 DR2 0000000000000000DR3 0000000000000000 DR6 00000000fffe0ff0 DR7 0000000000000400Call Trace __debug_check_no_obj_freed lib/debugobjects.c987 [inline] debug_check_no_obj_freed+0x301/0x420 lib/debugobjects.c1018 slab_free_hook mm/slub.c1603 [inline] slab_free_freelist_hook+0x171/0x240 mm/slub.c1653 slab_free mm/slub.c3213 [inline] kfree+0xe4/0x540 mm/slub.c4267 qdisc_create+0xbcf/0x1320 net/sched/sch_api.c1299 tc_modify_qdisc+0x4c8/0x1a60 net/sched/sch_api.c1663 rtnetlink_rcv_msg+0x413/0xb80 net/core/rtnetlink.c5571 netlink_rcv_skb+0x153/0x420 net/netlink/af_netlink.c2504 netlink_unicast_kernel net/netlink/af_netlink.c1314 [inline] netlink_unicast+0x533/0x7d0 net/netlink/af_netlink.c1340 netlink_sendmsg+0x86d/0xdb0 net/netlink/af_netlink.c1929 sock_sendmsg_nosec net/socket.c704 [inline] sock_sendmsg+0xcf/0x120 net/socket.c724 ____sys_sendmsg+0x6e8/0x810 net/socket.c2403 ___sys_sendmsg+0xf3/0x170 net/socket.c2457 __sys_sendmsg+0xe5/0x1b0 net/socket.c2486 do_syscall_x64 arch/x86/entry/common.c50 [inline] do_syscall_64+0x35/0xb0 arch/x86/entry/common.c80",
    "keyphrases": {
        "rootcause": "The taprio qdisc sets a timer before receiving a packet, but the timer was not properly canceled during destruction when ops->reset was not called, leading to a use-after-free.",
        "weakness": "The taprio qdisc's timer was not always canceled during destruction, particularly when ops->reset was not invoked, resulting in a resource leak and a potential use-after-free.",
        "impact": "The vulnerability can lead to a kernel crash or denial of service due to a use-after-free of a timer object, as demonstrated by the syzbot report showing a debug object being freed while still active.",
        "vector": "The vulnerability is triggered by creating and destroying a taprio qdisc without the underlying device ever becoming active, which prevents ops->reset from being called. The subsequent freeing of the qdisc without cancelling the timer causes the use-after-free.",
        "attacker": "An attacker could exploit this by crafting specific network configurations that repeatedly create and destroy taprio qdiscs, triggering the vulnerability and causing a denial-of-service or potentially more severe consequences.",
        "product": "Linux Kernel",
        "version": "5.14.0-rc6",
        "component": "net/sched/sch_taprio.c and net/sched/sch_api.c"
    }
}
