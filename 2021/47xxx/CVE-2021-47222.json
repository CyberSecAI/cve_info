{
    "cveId": "CVE-2021-47222",
    "version": "1.0.0",
    "timestamp": "2024-12-06T11:32:07.789868+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved net bridge fix vlan tunnel dst refcnt when egressing The egress tunnel code uses dst_clone() and directly sets the result which is wrong because the entry might have 0 refcnt or be already deleted, causing number of problems. It also triggers the WARN_ON() in dst_hold()[1] when a refcnt couldnt be taken. Fix it by using dst_hold_safe() and checking if a reference was actually taken before setting the dst. [1] dmesg WARN_ON log and following refcnt errors WARNING CPU 5 PID 38 at include/net/dst.h230 br_handle_egress_vlan_tunnel+0x10b/0x134 [bridge] Modules linked in 8021q garp mrp bridge stp llc bonding ipv6 virtio_net CPU 5 PID 38 Comm ksoftirqd/5 Kdump loaded Tainted G W 5.13.0-rc3+ #360 Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.14.0-1.fc33 04/01/2014 RIP 0010br_handle_egress_vlan_tunnel+0x10b/0x134 [bridge] Code e8 85 bc 01 e1 45 84 f6 74 90 45 31 f6 85 db 48 c7 c7 a0 02 19 a0 41 0f 94 c6 31 c9 31 d2 44 89 f6 e8 64 bc 01 e1 85 db 75 02 0b 31 c9 31 d2 44 89 f6 48 c7 c7 70 02 19 a0 e8 4b bc 01 e1 49 RSP 0018ffff8881003d39e8 EFLAGS 00010246 RAX 0000000000000000 RBX 0000000000000000 RCX 0000000000000000 RDX 0000000000000000 RSI 0000000000000001 RDI ffffffffa01902a0 RBP ffff8881040c6700 R08 0000000000000000 R09 0000000000000001 R10 2ce93d0054fe0d00 R11 54fe0d00000e0000 R12 ffff888109515000 R13 0000000000000000 R14 00000000000"
}
