{
    "cveId": "CVE-2021-47266",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedRDMA/ipoib Fix warning caused by destroying non-initial netnsAfter the commit 5ce2dced8e95 (RDMA/ipoib Set rtnl_link_ops for ipoibinterfaces), if the IPoIB device is moved to non-initial netns,destroying that netns lets the device vanish instead of moving it back tothe initial netns, This is happening because default_device_exit() skipsthe interfaces due to having rtnl_link_ops set.Steps to reporoduce ip netns add foo ip link set mlx5_ib0 netns foo ip netns delete fooWARNING CPU 1 PID 704 at net/core/dev.c11435 netdev_exit+0x3f/0x50Modules linked in xt_CHECKSUM xt_MASQUERADE xt_conntrack ipt_REJECTnf_reject_ipv4 nft_compat nft_counter nft_chain_nat nf_nat nf_conntracknf_defrag_ipv6 nf_defrag_ipv4 nf_tables nfnetlink tun d fuseCPU 1 PID 704 Comm kworker/u643 Tainted G S W 5.13.0-rc1+ #1Hardware name Dell Inc. PowerEdge R630/02C2CP, BIOS 2.1.5 04/11/2016Workqueue netns cleanup_netRIP 0010netdev_exit+0x3f/0x50Code 48 8b bb 30 01 00 00 e8 ef 81 b1 ff 48 81 fb c0 3a 54 a1 74 13 488b 83 90 00 00 00 48 81 c3 90 00 00 00 48 39 d8 75 02 5b c3 0b 5bc3 66 66 2e 0f 1f 84 00 00 00 00 00 66 90 0f 1f 44 00RSP 0018ffffb297079d7e08 EFLAGS 00010206RAX ffff8eb542c00040 RBX ffff8eb541333150 RCX 000000008010000dRDX 000000008010000e RSI 000000008010000d RDI ffff8eb440042c00RBP ffffb297079d7e48 R08 0000000000000001 R09 ffffffff9fdeac00R10 ffff8eb5003be000 R11 0000000000000001 R12 ffffffffa1545620R13 ffffffffa1545628 R14 0000000000000000 R15 ffffffffa1543b20FS 0000000000000000(0000) GSffff8ed37fa00000(0000) knlGS0000000000000000CS 0010 DS 0000 ES 0000 CR0 0000000080050033CR2 00005601b5f4c2e8 CR3 0000001fc8c10002 CR4 00000000003706e0DR0 0000000000000000 DR1 0000000000000000 DR2 0000000000000000DR3 0000000000000000 DR6 00000000fffe0ff0 DR7 0000000000000400Call Trace ops_exit_list.isra.9+0x36/0x70 cleanup_net+0x234/0x390 process_one_work+0x1cb/0x360 ? process_one_work+0x360/0x360 worker_thread+0x30/0x370 ? process_one_work+0x360/0x360 kthread+0x116/0x130 ? kthread_park+0x80/0x80 ret_from_fork+0x22/0x30To avoid the above warning and later on the kernel panic that could happenon shutdown due to a NULL pointer dereference, make sure to set thenetns_refund flag that was introduced by commit 3a5ca857079e (can devMove device back to init netns on owning netns delete) to properlyrestore the IPoIB interfaces to the initial netns.",
    "keyphrases": {
        "rootcause": "The IPoIB device is not moved back to the initial netns when the netns it belongs to is destroyed because default_device_exit() skips interfaces with rtnl_link_ops set.",
        "weakness": "The netns_refund flag, intended to move the interface back to the initial netns upon deletion of its netns, is not properly set for IPoIB interfaces.",
        "impact": "Warning messages are generated, and kernel panic could occur on shutdown due to a NULL pointer dereference.",
        "vector": "Moving an IPoIB device to a non-initial network namespace and then deleting that namespace.",
        "attacker": "An attacker with the ability to create and delete network namespaces.",
        "product": "Linux Kernel",
        "version": "5.13.0-rc1",
        "component": "RDMA/ipoib"
    }
}
