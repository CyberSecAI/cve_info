{
    "cveId": "CVE-2021-47588",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedsit do not call ipip6_dev_free() from sit_init_net()ipip6_dev_free is sit dev->priv_destructor, already calledby register_netdevice() if something goes wrong.Alternative would be to make ipip6_dev_free() robust againstmultiple invocations, but other drivers do not implement thisstrategy.syzbot reporteddst_release underflowWARNING CPU 0 PID 5059 at net/core/dst.c173 dst_release+0xd8/0xe0 net/core/dst.c173Modules linked inCPU 1 PID 5059 Comm syz-executor.4 Not tainted 5.16.0-rc5-syzkaller #0Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011RIP 0010dst_release+0xd8/0xe0 net/core/dst.c173Code 4c 89 f2 89 d9 31 c0 5b 41 5e 5d e9 da d5 44 f9 e8 1d 90 5f f9 c6 05 87 48 c6 05 01 48 c7 c7 80 44 99 8b 31 c0 e8 e8 67 29 f9 0b eb 85 0f 1f 40 00 53 48 89 fb e8 f7 8f 5f f9 48 83 c3 a8 48RSP 0018ffffc9000aa5faa0 EFLAGS 00010246RAX d6894a925dd15a00 RBX 00000000ffffffff RCX 0000000000040000RDX ffffc90005e19000 RSI 000000000003ffff RDI 0000000000040000RBP 0000000000000000 R08 ffffffff816a1f42 R09 ffffed1017344f2cR10 ffffed1017344f2c R11 0000000000000000 R12 0000607f462b1358R13 1ffffffff1bfd305 R14 ffffe8ffffcb1358 R15 dffffc0000000000FS 00007f66c71a2700(0000) GSffff8880b9a00000(0000) knlGS0000000000000000CS 0010 DS 0000 ES 0000 CR0 0000000080050033CR2 00007f88aaed5058 CR3 0000000023e0f000 CR4 00000000003506f0DR0 0000000000000000 DR1 0000000000000000 DR2 0000000000000000DR3 0000000000000000 DR6 00000000fffe0ff0 DR7 0000000000000400Call Trace dst_cache_destroy+0x107/0x1e0 net/core/dst_cache.c160 ipip6_dev_free net/ipv6/sit.c1414 [inline] sit_init_net+0x229/0x550 net/ipv6/sit.c1936 ops_init+0x313/0x430 net/core/net_namespace.c140 setup_net+0x35b/0x9d0 net/core/net_namespace.c326 copy_net_ns+0x359/0x5c0 net/core/net_namespace.c470 create_new_namespaces+0x4ce/0xa00 kernel/nsproxy.c110 unshare_nsproxy_namespaces+0x11e/0x180 kernel/nsproxy.c226 ksys_unshare+0x57d/0xb50 kernel/fork.c3075 __do_sys_unshare kernel/fork.c3146 [inline] __se_sys_unshare kernel/fork.c3144 [inline] __x64_sys_unshare+0x34/0x40 kernel/fork.c3144 do_syscall_x64 arch/x86/entry/common.c50 [inline] do_syscall_64+0x44/0xd0 arch/x86/entry/common.c80 entry_SYSCALL_64_after_hwframe+0x44/0xaeRIP 00330x7f66c882ce99Code ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 40 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 3d 01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48RSP 002b00007f66c71a2168 EFLAGS 00000246 ORIG_RAX 0000000000000110RAX ffffffffffffffda RBX 00007f66c893ff60 RCX 00007f66c882ce99RDX 0000000000000000 RSI 0000000000000000 RDI 0000000048040200RBP 00007f66c8886ff1 R08 0000000000000000 R09 0000000000000000R10 0000000000000000 R11 0000000000000246 R12 0000000000000000R13 00007fff6634832f R14 00007f66c71a2300 R15 0000000000022000",
    "keyphrases": {
        "rootcause": "The `ipip6_dev_free()` function is being called multiple times, leading to a double-free scenario. Specifically, it's being called from `sit_init_net()` and also as the destructor of the network device, resulting in a double free when something goes wrong during device registration.",
        "weakness": "The `ipip6_dev_free` function was not robust against multiple invocations. The destructor should only be called once and the code did not enforce this leading to use-after-free.",
        "impact": "A double-free condition leading to a kernel crash.",
        "vector": "The vulnerability can be triggered during network namespace creation and unsharing, through calls to `unshare()` system call with a `CLONE_NEWNET` flag. Specifically during the set up of the `sit` network device.",
        "attacker": "An attacker who has the ability to call `unshare()` with `CLONE_NEWNET`.",
        "product": "Linux Kernel",
        "version": "5.16.0-rc5",
        "component": "sit driver"
    }
}
