{
    "cveId": "CVE-2021-47238",
    "version": "1.0.0",
    "timestamp": "2024-12-17T08:36:27.567979+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvednet ipv4 fix memory leak in ip_mc_add1_srcBUG memory leakunreferenced object 0xffff888101bc4c00 (size 32) comm syz-executor527, pid 360, jiffies 4294807421 (age 19.329s) hex dump (first 32 bytes) 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 01 00 00 00 00 00 00 00 ac 14 14 bb 00 00 02 00 ................ backtrace [] kmalloc include/linux/slab.h558 [inline] [] kzalloc include/linux/slab.h688 [inline] [] ip_mc_add1_src net/ipv4/igmp.c1971 [inline] [] ip_mc_add_src+0x95f/0xdb0 net/ipv4/igmp.c2095 [] ip_mc_source+0x84c/0xea0 net/ipv4/igmp.c2416 [] do_ip_setsockopt net/ipv4/ip_sockglue.c1294 [inline] [] ip_setsockopt+0x114b/0x30c0 net/ipv4/ip_sockglue.c1423 [] raw_setsockopt+0x13d/0x170 net/ipv4/raw.c857 [] __sys_setsockopt+0x158/0x270 net/socket.c2117 [] __do_sys_setsockopt net/socket.c2128 [inline] [] __se_sys_setsockopt net/socket.c2125 [inline] [] __x64_sys_setsockopt+0xba/0x150 net/socket.c2125 [] do_syscall_64+0x40/0x80 arch/x86/entry/common.c47 [] entry_SYSCALL_64_after_hwframe+0x44/0xaeIn commit 24803f38a5c0 (igmp do not remove igmp souce list info when setlink down), the ip_mc_clear_src() in ip_mc_destroy_dev() was removed,because it was also called in igmpv3_clear_delrec().Rough callgraphinetdev_destroy-> ip_mc_destroy_dev -> igmpv3_clear_delrec -> ip_mc_clear_src-> RCU_INIT_POINTER(dev->ip_ptr, NULL)However, ip_mc_clear_src() called in igmpv3_clear_delrec() doesntrelease in_dev->mc_list->sources. And RCU_INIT_POINTER() assigns theNULL to dev->ip_ptr. As a result, in_dev cannot be obtained throughinetdev_by_index() and then in_dev->mc_list->sources cannot be releasedby ip_mc_del1_src() in the sock_close. Rough call sequence goes likesock_close-> __sock_release -> inet_release -> ip_mc_drop_socket -> inetdev_by_index -> ip_mc_leave_src -> ip_mc_del_src -> ip_mc_del1_srcSo we still need to call ip_mc_clear_src() in ip_mc_destroy_dev() to freein_dev->mc_list->sources.",
    "keyphrases": {
        "rootcause": "",
        "weakness": "memory leak",
        "impact": "",
        "vector": "",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": ""
    }
}
