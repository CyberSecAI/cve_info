{
    "cveId": "CVE-2021-47512",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvednet/sched fq_pie prevent dismantle issueFor some reason, fq_pie_destroy() did not copyworking code from pie_destroy() and other qdiscs,thus causing elusive bug.Before calling del_timer_sync(&q->adapt_timer),we need to ensure timer will not rearm itself.rcu INFO rcu_preempt self-detected stall on CPUrcu 0-.... (4416 ticks this GP) idle=60d/1/0x4000000000000000 softirq=10433/10434 fqs=2579 (t=10501 jiffies g=13085 q=3989)NMI backtrace for cpu 0CPU 0 PID 13 Comm ksoftirqd/0 Not tainted 5.16.0-rc4-syzkaller #0Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011Call Trace __dump_stack lib/dump_stack.c88 [inline] dump_stack_lvl+0xcd/0x134 lib/dump_stack.c106 nmi_cpu_backtrace.cold+0x47/0x144 lib/nmi_backtrace.c111 nmi_trigger_cpumask_backtrace+0x1b3/0x230 lib/nmi_backtrace.c62 trigger_single_cpu_backtrace include/linux/nmi.h164 [inline] rcu_dump_cpu_stacks+0x25e/0x3f0 kernel/rcu/tree_stall.h343 print_cpu_stall kernel/rcu/tree_stall.h627 [inline] check_cpu_stall kernel/rcu/tree_stall.h711 [inline] rcu_pending kernel/rcu/tree.c3878 [inline] rcu_sched_clock_irq.cold+0x9d/0x746 kernel/rcu/tree.c2597 update_process_times+0x16d/0x200 kernel/time/timer.c1785 tick_sched_handle+0x9b/0x180 kernel/time/tick-sched.c226 tick_sched_timer+0x1b0/0x2d0 kernel/time/tick-sched.c1428 __run_hrtimer kernel/time/hrtimer.c1685 [inline] __hrtimer_run_queues+0x1c0/0xe50 kernel/time/hrtimer.c1749 hrtimer_interrupt+0x31c/0x790 kernel/time/hrtimer.c1811 local_apic_timer_interrupt arch/x86/kernel/apic/apic.c1086 [inline] __sysvec_apic_timer_interrupt+0x146/0x530 arch/x86/kernel/apic/apic.c1103 sysvec_apic_timer_interrupt+0x8e/0xc0 arch/x86/kernel/apic/apic.c1097 asm_sysvec_apic_timer_interrupt+0x12/0x20 arch/x86/include/asm/idtentry.h638RIP 0010write_comp_data kernel/kcov.c221 [inline]RIP 0010__sanitizer_cov_trace_const_cmp1+0x1d/0x80 kernel/kcov.c273Code 54 c8 20 48 89 10 c3 66 0f 1f 44 00 00 53 41 89 fb 41 89 f1 bf 03 00 00 00 65 48 8b 0c 25 40 70 02 00 48 89 ce 4c 8b 54 24 08 4e f7 ff ff 84 c0 74 51 48 8b 81 88 15 00 00 44 8b 81 84 15 00RSP 0018ffffc90000d27b28 EFLAGS 00000246RAX 0000000000000000 RBX ffff888064bf1bf0 RCX ffff888011928000RDX ffff888011928000 RSI ffff888011928000 RDI 0000000000000003RBP ffff888064bf1c28 R08 0000000000000000 R09 0000000000000000R10 ffffffff875d8295 R11 0000000000000000 R12 0000000000000000R13 ffff8880783dd300 R14 0000000000000000 R15 0000000000000000 pie_calculate_probability+0x405/0x7c0 net/sched/sch_pie.c418 fq_pie_timer+0x170/0x2a0 net/sched/sch_fq_pie.c383 call_timer_fn+0x1a5/0x6b0 kernel/time/timer.c1421 expire_timers kernel/time/timer.c1466 [inline] __run_timers.part.0+0x675/0xa20 kernel/time/timer.c1734 __run_timers kernel/time/timer.c1715 [inline] run_timer_softirq+0xb3/0x1d0 kernel/time/timer.c1747 __do_softirq+0x29b/0x9c2 kernel/softirq.c558 run_ksoftirqd kernel/softirq.c921 [inline] run_ksoftirqd+0x2d/0x60 kernel/softirq.c913 smpboot_thread_fn+0x645/0x9c0 kernel/smpboot.c164 kthread+0x405/0x4f0 kernel/kthread.c327 ret_from_fork+0x1f/0x30 arch/x86/entry/entry_64.S295",
    "keyphrases": {
        "rootcause": "The fq_pie_destroy() function in the Linux kernel did not properly handle the timer deactivation, leading to a use-after-free condition due to the timer rearming itself after being freed.",
        "weakness": "Improper timer deactivation in fq_pie_destroy() leading to a use-after-free vulnerability.",
        "impact": "Kernel crash due to use-after-free, potentially leading to denial of service.",
        "vector": "The vulnerability is triggered by the timer mechanism within the fq_pie qdisc.",
        "attacker": "An attacker can trigger this vulnerability via network traffic manipulation that interacts with the fq_pie qdisc in a way that causes the timer to be improperly handled.",
        "product": "Linux Kernel",
        "version": "5.16.0-rc4",
        "component": "net/sched fq_pie"
    }
}
