{
    "cveId": "CVE-2021-4442",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedtcp add sanity tests to TCP_QUEUE_SEQQingyu Li reported a syzkaller bug where the reprochanges RCV SEQ _after_ restoring data in the receive queue.mprotect(0x4aa000, 12288, PROT_READ) = 0mmap(0x1ffff000, 4096, PROT_NONE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x1ffff000mmap(0x20000000, 16777216, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x20000000mmap(0x21000000, 4096, PROT_NONE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x21000000socket(AF_INET6, SOCK_STREAM, IPPROTO_IP) = 3setsockopt(3, SOL_TCP, TCP_REPAIR, [1], 4) = 0connect(3, {sa_family=AF_INET6, sin6_port=htons(0), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, 1, &sin6_addr), sin6_scope_id=0}, 28) = 0setsockopt(3, SOL_TCP, TCP_REPAIR_QUEUE, [1], 4) = 0sendmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base=0x0000000000000003\\0\\0, iov_len=20}], msg_iovlen=1, msg_controllen=0, msg_flags=0}, 0) = 20setsockopt(3, SOL_TCP, TCP_REPAIR, [0], 4) = 0setsockopt(3, SOL_TCP, TCP_QUEUE_SEQ, [128], 4) = 0recvfrom(3, NULL, 20, 0, NULL, NULL) = -1 ECONNRESET (Connection reset by peer)syslog shows[ 111.205099] TCP recvmsg seq # bug 2 copied 80, seq 0, rcvnxt 80, fl 0[ 111.207894] WARNING CPU 1 PID 356 at net/ipv4/tcp.c2343 tcp_recvmsg_locked+0x90e/0x29a0This should not be allowed. TCP_QUEUE_SEQ should only be usedwhen queues are empty.This patch fixes this case, and the tx path as well.",
    "keyphrases": {
        "rootcause": "The TCP_QUEUE_SEQ option in the Linux kernel can be used to modify the receive sequence number after data has already been received and placed in the receive queue, leading to inconsistencies and potential crashes.",
        "weakness": "Improper handling of TCP sequence numbers when using the TCP_QUEUE_SEQ option.",
        "impact": "Kernel panic or other undefined behavior due to corrupted TCP state. The system could become unstable.",
        "vector": "An attacker can exploit this by crafting network packets and using the TCP_REPAIR and TCP_QUEUE_SEQ socket options.",
        "attacker": "An attacker who can establish a TCP connection and manipulate socket options.",
        "product": "Linux Kernel",
        "version": "Affected versions prior to the fix",
        "component": "TCP/IP Stack"
    }
}
