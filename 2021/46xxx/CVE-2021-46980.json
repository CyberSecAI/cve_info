{
    "cveId": "CVE-2021-46980",
    "version": "1.0.0",
    "timestamp": "2024-12-06T11:32:07.789868+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved usb typec ucsi Retrieve all the PDOs instead of just the first 4 commit 4dbc6a4ef06d (usb typec ucsi save power data objects in PD mode) introduced retrieval of the PDOs when connected to a PD-capable source. But only the first 4 PDOs are received since that is the maximum number that can be fetched at a time given the MESSAGE_IN length limitation (16 bytes). However, as per the PD spec a connected source may advertise up to a maximum of 7 PDOs. If such a source is connected its possible the PPM could have negotiated a power contract with one of the PDOs at index greater than 4, and would be reflected in the request data objects (RDO) object position field. This would result in an out-of-bounds access when the rdo_index() is used to index into the src_pdos array in ucsi_psy_get_voltage_now(). With the help of the UBSAN -fsanitize=array-bounds checker enabled this exact issue is revealed when connecting to a PD source adapter that advertise 5 PDOs and the PPM enters a contract having selected the 5th one. [ 151.545106][ T70] Unexpected kernel BRK exception at EL1 [ 151.545112][ T70] Internal error BRK handler f2005512 [#1] PREEMPT SMP ... [ 151.545499][ T70] pc ucsi_psy_get_prop+0x208/0x20c [ 151.545507][ T70] lr power_supply_show_property+0xc0/0x328 ... [ 151.545542][ T70] Call trace [ 151.545544][ T70] ucsi_psy_get_prop+0x208/0x20c [ 151.545546][ T70] power_supply",
    "keyphrases": {
        "rootcause": "out-of-bounds access when the rdo_index() is used to index into the src_pdos array",
        "weakness": "",
        "impact": "",
        "vector": "",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": "usb typec ucsi"
    }
}
