{
    "cveId": "CVE-2021-46970",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedbus mhi pci_generic Remove WQ_MEM_RECLAIM flag from state workqueueA recent change created a dedicated workqueue for the state-change workwith WQ_HIGHPRI (no strong reason for that) and WQ_MEM_RECLAIM flags,but the state-change work (mhi_pm_st_worker) does not guarantee forwardprogress under memory pressure, and will even wait on various memoryallocations when e.g. creating devices, loading firmware, etc... Thework is then not part of a memory reclaim path...Moreover, this causes a warning in check_flush_dependency() since we endup in code that flushes a non-reclaim workqueue[ 40.969601] workqueue WQ_MEM_RECLAIM mhi_hiprio_wqmhi_pm_st_worker [mhi] is flushing !WQ_MEM_RECLAIM events_highpriflush_backlog[ 40.969612] WARNING CPU 4 PID 158 at kernel/workqueue.c2607 check_flush_dependency+0x11c/0x140[ 40.969733] Call Trace[ 40.969740] __flush_work+0x97/0x1d0[ 40.969745] ? wake_up_process+0x15/0x20[ 40.969749] ? insert_work+0x70/0x80[ 40.969750] ? __queue_work+0x14a/0x3e0[ 40.969753] flush_work+0x10/0x20[ 40.969756] rollback_registered_many+0x1c9/0x510[ 40.969759] unregister_netdevice_queue+0x94/0x120[ 40.969761] unregister_netdev+0x1d/0x30[ 40.969765] mhi_net_remove+0x1a/0x40 [mhi_net][ 40.969770] mhi_driver_remove+0x124/0x250 [mhi][ 40.969776] device_release_driver_internal+0xf0/0x1d0[ 40.969778] device_release_driver+0x12/0x20[ 40.969782] bus_remove_device+0xe1/0x150[ 40.969786] device_del+0x17b/0x3e0[ 40.969791] mhi_destroy_device+0x9a/0x100 [mhi][ 40.969796] ? mhi_unmap_single_use_bb+0x50/0x50 [mhi][ 40.969799] device_for_each_child+0x5e/0xa0[ 40.969804] mhi_pm_st_worker+0x921/0xf50 [mhi]",
    "keyphrases": {
        "rootcause": "The state-change workqueue was incorrectly configured with the WQ_MEM_RECLAIM flag, which is not appropriate as it can lead to deadlocks.",
        "weakness": "Incorrect use of WQ_MEM_RECLAIM flag on a workqueue that can wait on memory allocations",
        "impact": "Potential deadlock and warning due to flushing a non-reclaim workqueue.",
        "vector": "The vulnerability is triggered during the removal of a network device using the mhi driver.",
        "attacker": "An attacker can trigger this by forcing frequent device unregister/register cycles.",
        "product": "Linux Kernel",
        "version": "All versions with the affected code.",
        "component": "mhi (Mobile Host Interface) PCI driver"
    }
}
