{
    "cveId": "CVE-2024-41094",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolveddrm/fbdev-dma Only set smem_start is enable per module optionOnly export struct fb_info.fix.smem_start if that is required by theuser and the memory does not come from vmalloc().Setting struct fb_info.fix.smem_start breaks systems where DMAmemory is backed by vmalloc address space. An example error isshown below.[ 3.536043] ------------[ cut here ]------------[ 3.540716] virt_to_phys used for non-linear address 000000007fc4f540 (0xffff800086001000)[ 3.552628] WARNING CPU 4 PID 61 at arch/arm64/mm/physaddr.c12 __virt_to_phys+0x68/0x98[ 3.565455] Modules linked in[ 3.568525] CPU 4 PID 61 Comm kworker/u125 Not tainted 6.6.23-06226-g4986cc3e1b75-dirty #250[ 3.577310] Hardware name NXP i.MX95 19X19 board (DT)[ 3.582452] Workqueue events_unbound deferred_probe_work_func[ 3.588291] pstate 60400009 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)[ 3.595233] pc __virt_to_phys+0x68/0x98[ 3.599246] lr __virt_to_phys+0x68/0x98[ 3.603276] sp ffff800083603990[ 3.677939] Call trace[ 3.680393] __virt_to_phys+0x68/0x98[ 3.684067] drm_fbdev_dma_helper_fb_probe+0x138/0x238[ 3.689214] __drm_fb_helper_initial_config_and_unlock+0x2b0/0x4c0[ 3.695385] drm_fb_helper_initial_config+0x4c/0x68[ 3.700264] drm_fbdev_dma_client_hotplug+0x8c/0xe0[ 3.705161] drm_client_register+0x60/0xb0[ 3.709269] drm_fbdev_dma_setup+0x94/0x148Additionally, DMA memory is assumed to by contiguous in physicaladdress space, which is not guaranteed by vmalloc().Resolve this by checking the module flag drm_leak_fbdev_smem whenDRM allocated the instance of struct fb_info. Fbdev-dma then onlysets smem_start only if required (via FBINFO_HIDE_SMEM_START). Alsoguarantee that the framebuffer is not located in vmalloc addressspace.",
    "keyphrases": {
        "rootcause": "Setting struct fb_info.fix.smem_start breaks systems where DMA memory is backed by vmalloc address space, and DMA memory is assumed to be contiguous in physical address space, which is not guaranteed by vmalloc().",
        "weakness": "Incorrect handling of DMA memory backed by vmalloc address space within the fbdev-dma driver.",
        "impact": "System instability and crashes due to virt_to_phys used for non-linear address and assumption of contiguous physical address space.",
        "vector": "The vulnerability is triggered by incorrect setup of the framebuffer using the fbdev-dma driver with vmalloc'ed memory.",
        "attacker": "An attacker could exploit this by crafting a device configuration that forces the driver to use vmalloc'ed memory for the framebuffer.",
        "product": "Linux Kernel",
        "version": "The provided log suggests a version around 6.6.23, but the specific commit is needed to pinpoint exact vulnerable versions.",
        "component": "drm/fbdev-dma"
    }
}
