{
    "cveId": "CVE-2024-35888",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvederspan make sure erspan_base_hdr is present in skb->headsyzbot reported a problem in ip6erspan_rcv() [1]Issue is that ip6erspan_rcv() (and erspan_rcv()) no longer makesure erspan_base_hdr is present in skb linear part (skb->head)before getting @ver field from it.Add the missing pskb_may_pull() calls.v2 Reload iph pointer in erspan_rcv() after pskb_may_pull() because skb->head might have changed.[1] BUG KMSAN uninit-value in pskb_may_pull_reason include/linux/skbuff.h2742 [inline] BUG KMSAN uninit-value in pskb_may_pull include/linux/skbuff.h2756 [inline] BUG KMSAN uninit-value in ip6erspan_rcv net/ipv6/ip6_gre.c541 [inline] BUG KMSAN uninit-value in gre_rcv+0x11f8/0x1930 net/ipv6/ip6_gre.c610 pskb_may_pull_reason include/linux/skbuff.h2742 [inline] pskb_may_pull include/linux/skbuff.h2756 [inline] ip6erspan_rcv net/ipv6/ip6_gre.c541 [inline] gre_rcv+0x11f8/0x1930 net/ipv6/ip6_gre.c610 ip6_protocol_deliver_rcu+0x1d4c/0x2ca0 net/ipv6/ip6_input.c438 ip6_input_finish net/ipv6/ip6_input.c483 [inline] NF_HOOK include/linux/netfilter.h314 [inline] ip6_input+0x15d/0x430 net/ipv6/ip6_input.c492 ip6_mc_input+0xa7e/0xc80 net/ipv6/ip6_input.c586 dst_input include/net/dst.h460 [inline] ip6_rcv_finish+0x955/0x970 net/ipv6/ip6_input.c79 NF_HOOK include/linux/netfilter.h314 [inline] ipv6_rcv+0xde/0x390 net/ipv6/ip6_input.c310 __netif_receive_skb_one_core net/core/dev.c5538 [inline] __netif_receive_skb+0x1da/0xa00 net/core/dev.c5652 netif_receive_skb_internal net/core/dev.c5738 [inline] netif_receive_skb+0x58/0x660 net/core/dev.c5798 tun_rx_batched+0x3ee/0x980 drivers/net/tun.c1549 tun_get_user+0x5566/0x69e0 drivers/net/tun.c2002 tun_chr_write_iter+0x3af/0x5d0 drivers/net/tun.c2048 call_write_iter include/linux/fs.h2108 [inline] new_sync_write fs/read_write.c497 [inline] vfs_write+0xb63/0x1520 fs/read_write.c590 ksys_write+0x20f/0x4c0 fs/read_write.c643 __do_sys_write fs/read_write.c655 [inline] __se_sys_write fs/read_write.c652 [inline] __x64_sys_write+0x93/0xe0 fs/read_write.c652 do_syscall_64+0xd5/0x1f0 entry_SYSCALL_64_after_hwframe+0x6d/0x75Uninit was created at slab_post_alloc_hook mm/slub.c3804 [inline] slab_alloc_node mm/slub.c3845 [inline] kmem_cache_alloc_node+0x613/0xc50 mm/slub.c3888 kmalloc_reserve+0x13d/0x4a0 net/core/skbuff.c577 __alloc_skb+0x35b/0x7a0 net/core/skbuff.c668 alloc_skb include/linux/skbuff.h1318 [inline] alloc_skb_with_frags+0xc8/0xbf0 net/core/skbuff.c6504 sock_alloc_send_pskb+0xa81/0xbf0 net/core/sock.c2795 tun_alloc_skb drivers/net/tun.c1525 [inline] tun_get_user+0x209a/0x69e0 drivers/net/tun.c1846 tun_chr_write_iter+0x3af/0x5d0 drivers/net/tun.c2048 call_write_iter include/linux/fs.h2108 [inline] new_sync_write fs/read_write.c497 [inline] vfs_write+0xb63/0x1520 fs/read_write.c590 ksys_write+0x20f/0x4c0 fs/read_write.c643 __do_sys_write fs/read_write.c655 [inline] __se_sys_write fs/read_write.c652 [inline] __x64_sys_write+0x93/0xe0 fs/read_write.c652 do_syscall_64+0xd5/0x1f0 entry_SYSCALL_64_after_hwframe+0x6d/0x75CPU 1 PID 5045 Comm syz-executor114 Not tainted 6.9.0-rc1-syzkaller-00021-g962490525cff #0",
    "keyphrases": {
        "rootcause": "The `erspan_rcv()` and `ip6erspan_rcv()` functions were not ensuring that the `erspan_base_hdr` was present in the linear part of the skb (skb->head) before accessing the version field. This caused an uninitialized memory access when `pskb_may_pull()` tried to access the header.",
        "weakness": "Missing check to ensure that the erspan base header is present in the skb linear part before accessing it. Specifically, missing `pskb_may_pull()` calls before accessing the header.",
        "impact": "Kernel memory leak due to accessing uninitialized memory leading to potential system instability or crash.",
        "vector": "Receiving a crafted ERSPAN packet over the network or using a TUN device.",
        "attacker": "An attacker able to send specially crafted ERSPAN packets.",
        "product": "Linux Kernel",
        "version": "6.9.0-rc1",
        "component": "net/ipv6/ip6_gre.c, drivers/net/tun.c, net/core/skbuff.c"
    }
}
