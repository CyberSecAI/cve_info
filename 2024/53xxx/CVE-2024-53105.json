{
    "cveId": "CVE-2024-53105",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved mm page_alloc move mlocked flag clearance into free_pages_prepare() Syzbot reported a bad page state problem caused by a page being freed using free_page() still having a mlocked flag at free_pages_prepare() stage BUG Bad page state in process syz.5.504 pfn61f45 page refcount0 mapcount0 mapping0000000000000000 index0x0 pfn0x61f45 flags 0xfff00000080204(referenced|workingset|mlocked|node=0|zone=1|lastcpupid=0x7ff) raw 00fff00000080204 0000000000000000 dead000000000122 0000000000000000 raw 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000 page dumped because PAGE_FLAGS_CHECK_AT_FREE flag(s) set page_owner tracks the page as allocated page last allocated via order 0, migratetype Unmovable, gfp_mask 0x400dc0(GFP_KERNEL_ACCOUNT|__GFP_ZERO), pid 8443, tgid 8442 (syz.5.504), ts 201884660643, free_ts 201499827394 set_page_owner include/linux/page_owner.h32 [inline] post_alloc_hook+0x1f3/0x230 mm/page_alloc.c1537 prep_new_page mm/page_alloc.c1545 [inline] get_page_from_freelist+0x303f/0x3190 mm/page_alloc.c3457 __alloc_pages_noprof+0x292/0x710 mm/page_alloc.c4733 alloc_pages_mpol_noprof+0x3e8/0x680 mm/mempolicy.c2265 kvm_coalesced_mmio_init+0x1f/0xf0 virt/kvm/coalesced_mmio.c99 kvm_create_vm virt/kvm/kvm_main.c1235 [inline] kvm_dev_ioctl_create_vm virt/kvm/kvm_main.c5488 [inline] kvm_dev_ioctl+0x12dc/0x2240 virt/kvm/kvm_main.c5530 __do_compat_sys_ioctl fs/ioctl.c1007 [inline] __se_compat_sys_ioctl+0x510/0xc90 fs/ioctl.c950 do_syscall_32_irqs_on arch/x86/entry/common.c165 [inline] __do_fast_syscall_32+0xb4/0x110 arch/x86/entry/common.c386 do_fast_syscall_32+0x34/0x80 arch/x86/entry/common.c411 entry_SYSENTER_compat_after_hwframe+0x84/0x8e page last free pid 8399 tgid 8399 stack trace reset_page_owner include/linux/page_owner.h25 [inline] free_pages_prepare mm/page_alloc.c1108 [inline] free_unref_folios+0xf12/0x18d0 mm/page_alloc.c2686 folios_put_refs+0x76c/0x860 mm/swap.c1007 free_pages_and_swap_cache+0x5c8/0x690 mm/swap_state.c335 __tlb_batch_free_encoded_pages mm/mmu_gather.c136 [inline] tlb_batch_pages_flush mm/mmu_gather.c149 [inline] tlb_flush_mmu_free mm/mmu_gather.c366 [inline] tlb_flush_mmu+0x3a3/0x680 mm/mmu_gather.c373 tlb_finish_mmu+0xd4/0x200 mm/mmu_gather.c465 exit_mmap+0x496/0xc40 mm/mmap.c1926 __mmput+0x115/0x390 kernel/fork.c1348 exit_mm+0x220/0x310 kernel/exit.c571 do_exit+0x9b2/0x28e0 kernel/exit.c926 do_group_exit+0x207/0x2c0 kernel/exit.c1088 __do_sys_exit_group kernel/exit.c1099 [inline] __se_sys_exit_group kernel/exit.c1097 [inline] __x64_sys_exit_group+0x3f/0x40 kernel/exit.c1097 x64_sys_call+0x2634/0x2640 arch/x86/include/generated/asm/syscalls_64.h232 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xf3/0x230 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7f Modules linked in CPU 0 UID 0 PID 8442 Comm syz.5.504 Not tainted 6.12.0-rc6-syzkaller #0 Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024 Call Trace __dump_stack lib/dump_stack.c94 [inline] dump_stack_lvl+0x241/0x360 lib/dump_stack.c120 bad_page+0x176/0x1d0 mm/page_alloc.c501 free_page_is_bad mm/page_alloc.c918 [inline] free_pages_prepare mm/page_alloc.c1100 [inline] free_unref_page+0xed0/0xf20 mm/page_alloc.c2638 kvm_destroy_vm virt/kvm/kvm_main.c1327 [inline] kvm_put_kvm+0xc75/0x1350 virt/kvm/kvm_main.c1386 kvm_vcpu_release+0x54/0x60 virt/kvm/kvm_main.c4143 __fput+0x23f/0x880 fs/file_table.c431 task_work_run+0x24f/0x310 kernel/task_work.c239 exit_task_work include/linux/task_work.h43 [inline] do_exit+0xa2f/0x28e0 kernel/exit.c939 do_group_exit+0x207/0x2c0 kernel/exit.c1088 __do_sys_exit_group kernel/exit.c1099 [in ---truncated---",
    "keyphrases": {
        "rootcause": "The mlocked flag was not cleared before freeing the page, leading to a bad page state during free_pages_prepare().",
        "weakness": "The mlocked flag was not being cleared when a page is freed.",
        "impact": "A bad page state resulting in kernel panic.",
        "vector": "The vulnerability can be triggered by freeing a page that still has the mlocked flag set.",
        "attacker": "syzbot",
        "product": "Linux Kernel",
        "version": "6.12.0-rc6",
        "component": "mm page_alloc"
    }
}
