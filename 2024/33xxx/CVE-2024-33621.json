{
    "cveId": "CVE-2024-33621",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedipvlan Dont Use skb->sk in ipvlan_process_v{4,6}_outboundRaw packet from PF_PACKET socket ontop of an IPv6-backed ipvlan device willhit WARN_ON_ONCE() in sk_mc_loop() through sch_direct_xmit() path.WARNING CPU 2 PID 0 at net/core/sock.c775 sk_mc_loop+0x2d/0x70Modules linked in sch_netem ipvlan rfkill cirrus drm_shmem_helper sg drm_kms_helperCPU 2 PID 0 Comm swapper/2 Kdump loaded Not tainted 6.9.0+ #279Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014RIP 0010sk_mc_loop+0x2d/0x70Code fa 0f 1f 44 00 00 65 0f b7 15 f7 96 a3 4f 31 c0 66 85 d2 75 26 48 85 ff 74 1cRSP 0018ffffa9584015cd78 EFLAGS 00010212RAX 0000000000000011 RBX ffff91e585793e00 RCX 0000000002c6a001RDX 0000000000000000 RSI 0000000000000040 RDI ffff91e589c0f000RBP ffff91e5855bd100 R08 0000000000000000 R09 3d00545216f43d00R10 ffff91e584fdcc50 R11 00000060dd8616f4 R12 ffff91e58132d000R13 ffff91e584fdcc68 R14 ffff91e5869ce800 R15 ffff91e589c0f000FS 0000000000000000(0000) GSffff91e898100000(0000) knlGS0000000000000000CS 0010 DS 0000 ES 0000 CR0 0000000080050033CR2 00007f788f7c44c0 CR3 0000000008e1a000 CR4 00000000000006f0DR0 0000000000000000 DR1 0000000000000000 DR2 0000000000000000DR3 0000000000000000 DR6 00000000fffe0ff0 DR7 0000000000000400Call Trace ? __warn (kernel/panic.c693) ? sk_mc_loop (net/core/sock.c760) ? report_bug (lib/bug.c201 lib/bug.c219) ? handle_bug (arch/x86/kernel/traps.c239) ? exc_invalid_op (arch/x86/kernel/traps.c260 (discriminator 1)) ? asm_exc_invalid_op (./arch/x86/include/asm/idtentry.h621) ? sk_mc_loop (net/core/sock.c760) ip6_finish_output2 (net/ipv6/ip6_output.c83 (discriminator 1)) ? nf_hook_slow (net/netfilter/core.c626) ip6_finish_output (net/ipv6/ip6_output.c222) ? __pfx_ip6_finish_output (net/ipv6/ip6_output.c215) ipvlan_xmit_mode_l3 (drivers/net/ipvlan/ipvlan_core.c602) ipvlan ipvlan_start_xmit (drivers/net/ipvlan/ipvlan_main.c226) ipvlan dev_hard_start_xmit (net/core/dev.c3594) sch_direct_xmit (net/sched/sch_generic.c343) __qdisc_run (net/sched/sch_generic.c416) net_tx_action (net/core/dev.c5286) handle_softirqs (kernel/softirq.c555) __irq_exit_rcu (kernel/softirq.c589) sysvec_apic_timer_interrupt (arch/x86/kernel/apic/apic.c1043)The warning triggers as thispacket_sendmsg packet_snd //skb->sk is packet sk __dev_queue_xmit __dev_xmit_skb //q->enqueue is not NULL __qdisc_run sch_direct_xmit dev_hard_start_xmit ipvlan_start_xmit ipvlan_xmit_mode_l3 //l3 mode ipvlan_process_outbound //vepa flag ipvlan_process_v6_outbound ip6_local_out __ip6_finish_output ip6_finish_output2 //multicast packet sk_mc_loop //sk->sk_family is AF_PACKETCall ip{6}_local_out() with NULL sk in ipvlan as other tunnels to fix this.",
    "keyphrases": {
        "rootcause": "The ipvlan driver does not properly handle skb->sk in ipvlan_process_v{4,6}_outbound when a raw packet from a PF_PACKET socket is sent over an IPv6-backed ipvlan device, leading to a NULL pointer dereference in sk_mc_loop() through sch_direct_xmit().",
        "weakness": "The ipvlan driver lacks proper checks for skb->sk in the outbound processing path for raw packets.",
        "impact": "The vulnerability triggers a kernel warning (WARN_ON_ONCE) and can potentially cause a kernel panic or system instability.",
        "vector": "Sending raw packets from a PF_PACKET socket on top of an IPv6-backed ipvlan device.",
        "attacker": "A user with the ability to send raw packets using PF_PACKET sockets.",
        "product": "Linux Kernel",
        "version": "6.9.0",
        "component": "ipvlan driver"
    }
}
