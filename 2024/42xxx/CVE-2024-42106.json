{
    "cveId": "CVE-2024-42106",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedinet_diag Initialize pad field in struct inet_diag_req_v2KMSAN reported uninit-value access in raw_lookup() [1]. Diag for rawsockets uses the pad field in struct inet_diag_req_v2 for theunderlying protocol. This field corresponds to the sdiag_raw_protocolfield in struct inet_diag_req_raw.inet_diag_get_exact_compat() converts inet_diag_req toinet_diag_req_v2, but leaves the pad field uninitialized. So the issueoccurs when raw_lookup() accesses the sdiag_raw_protocol field.Fix this by initializing the pad field ininet_diag_get_exact_compat(). Also, do the same fix ininet_diag_dump_compat() to avoid the similar issue in the future.[1]BUG KMSAN uninit-value in raw_lookup net/ipv4/raw_diag.c49 [inline]BUG KMSAN uninit-value in raw_sock_get+0x657/0x800 net/ipv4/raw_diag.c71 raw_lookup net/ipv4/raw_diag.c49 [inline] raw_sock_get+0x657/0x800 net/ipv4/raw_diag.c71 raw_diag_dump_one+0xa1/0x660 net/ipv4/raw_diag.c99 inet_diag_cmd_exact+0x7d9/0x980 inet_diag_get_exact_compat net/ipv4/inet_diag.c1404 [inline] inet_diag_rcv_msg_compat+0x469/0x530 net/ipv4/inet_diag.c1426 sock_diag_rcv_msg+0x23d/0x740 net/core/sock_diag.c282 netlink_rcv_skb+0x537/0x670 net/netlink/af_netlink.c2564 sock_diag_rcv+0x35/0x40 net/core/sock_diag.c297 netlink_unicast_kernel net/netlink/af_netlink.c1335 [inline] netlink_unicast+0xe74/0x1240 net/netlink/af_netlink.c1361 netlink_sendmsg+0x10c6/0x1260 net/netlink/af_netlink.c1905 sock_sendmsg_nosec net/socket.c730 [inline] __sock_sendmsg+0x332/0x3d0 net/socket.c745 ____sys_sendmsg+0x7f0/0xb70 net/socket.c2585 ___sys_sendmsg+0x271/0x3b0 net/socket.c2639 __sys_sendmsg net/socket.c2668 [inline] __do_sys_sendmsg net/socket.c2677 [inline] __se_sys_sendmsg net/socket.c2675 [inline] __x64_sys_sendmsg+0x27e/0x4a0 net/socket.c2675 x64_sys_call+0x135e/0x3ce0 arch/x86/include/generated/asm/syscalls_64.h47 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xd9/0x1e0 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7fUninit was stored to memory at raw_sock_get+0x650/0x800 net/ipv4/raw_diag.c71 raw_diag_dump_one+0xa1/0x660 net/ipv4/raw_diag.c99 inet_diag_cmd_exact+0x7d9/0x980 inet_diag_get_exact_compat net/ipv4/inet_diag.c1404 [inline] inet_diag_rcv_msg_compat+0x469/0x530 net/ipv4/inet_diag.c1426 sock_diag_rcv_msg+0x23d/0x740 net/core/sock_diag.c282 netlink_rcv_skb+0x537/0x670 net/netlink/af_netlink.c2564 sock_diag_rcv+0x35/0x40 net/core/sock_diag.c297 netlink_unicast_kernel net/netlink/af_netlink.c1335 [inline] netlink_unicast+0xe74/0x1240 net/netlink/af_netlink.c1361 netlink_sendmsg+0x10c6/0x1260 net/netlink/af_netlink.c1905 sock_sendmsg_nosec net/socket.c730 [inline] __sock_sendmsg+0x332/0x3d0 net/socket.c745 ____sys_sendmsg+0x7f0/0xb70 net/socket.c2585 ___sys_sendmsg+0x271/0x3b0 net/socket.c2639 __sys_sendmsg net/socket.c2668 [inline] __do_sys_sendmsg net/socket.c2677 [inline] __se_sys_sendmsg net/socket.c2675 [inline] __x64_sys_sendmsg+0x27e/0x4a0 net/socket.c2675 x64_sys_call+0x135e/0x3ce0 arch/x86/include/generated/asm/syscalls_64.h47 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xd9/0x1e0 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7fLocal variable req.i created at inet_diag_get_exact_compat net/ipv4/inet_diag.c1396 [inline] inet_diag_rcv_msg_compat+0x2a6/0x530 net/ipv4/inet_diag.c1426 sock_diag_rcv_msg+0x23d/0x740 net/core/sock_diag.c282CPU 1 PID 8888 Comm syz-executor.6 Not tainted 6.10.0-rc4-00217-g35bb670d65fc #32Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.16.3-2.fc40 04/01/2014",
    "keyphrases": {
        "rootcause": "The pad field in struct inet_diag_req_v2 was left uninitialized in inet_diag_get_exact_compat(), leading to an uninitialized memory access when raw_lookup() accessed the corresponding sdiag_raw_protocol field.",
        "weakness": "Uninitialized data vulnerability due to missing initialization of the 'pad' field in 'inet_diag_req_v2' during conversion from 'inet_diag_req'.",
        "impact": "KMSAN reported uninit-value access in raw_lookup(), potentially leading to unpredictable behavior or a crash.",
        "vector": "The vulnerability can be triggered by sending a netlink message that uses the inet_diag interface and results in the execution of raw_lookup().",
        "attacker": "An attacker with the ability to send netlink messages can potentially trigger this vulnerability.",
        "product": "Linux Kernel",
        "version": "6.10.0-rc4-00217-g35bb670d65fc",
        "component": "net/ipv4/raw_diag.c and net/ipv4/inet_diag.c"
    }
}
