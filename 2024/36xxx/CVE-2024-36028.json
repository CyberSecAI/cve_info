{
    "cveId": "CVE-2024-36028",
    "version": "1.0.0",
    "timestamp": "2024-12-18T22:42:50.929578+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedmm/hugetlb fix DEBUG_LOCKS_WARN_ON(1) when dissolve_free_hugetlb_folio()When I did memory failure tests recently, below warning occursDEBUG_LOCKS_WARN_ON(1)WARNING CPU 8 PID 1011 at kernel/locking/lockdep.c232 __lock_acquire+0xccb/0x1ca0Modules linked in mce_inject hwpoison_injectCPU 8 PID 1011 Comm bash Kdump loaded Not tainted 6.9.0-rc3-next-20240410-00012-gdb69f219f4be #3Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.14.0-0-g155821a1990b-prebuilt.qemu.org 04/01/2014RIP 0010__lock_acquire+0xccb/0x1ca0RSP 0018ffffa7a1c7fe3bd0 EFLAGS 00000082RAX 0000000000000000 RBX eb851eb853975fcf RCX ffffa1ce5fc1c9c8RDX 00000000ffffffd8 RSI 0000000000000027 RDI ffffa1ce5fc1c9c0RBP ffffa1c6865d3280 R08 ffffffffb0f570a8 R09 0000000000009ffbR10 0000000000000286 R11 ffffffffb0f2ad50 R12 ffffa1c6865d3d10R13 ffffa1c6865d3c70 R14 0000000000000000 R15 0000000000000004FS 00007ff9f32aa740(0000) GSffffa1ce5fc00000(0000) knlGS0000000000000000CS 0010 DS 0000 ES 0000 CR0 0000000080050033CR2 00007ff9f3134ba0 CR3 00000008484e4000 CR4 00000000000006f0Call Trace lock_acquire+0xbe/0x2d0 _raw_spin_lock_irqsave+0x3a/0x60 hugepage_subpool_put_pages.part.0+0xe/0xc0 free_huge_folio+0x253/0x3f0 dissolve_free_huge_page+0x147/0x210 __page_handle_poison+0x9/0x70 memory_failure+0x4e6/0x8c0 hard_offline_page_store+0x55/0xa0 kernfs_fop_write_iter+0x12c/0x1d0 vfs_write+0x380/0x540 ksys_write+0x64/0xe0 do_syscall_64+0xbc/0x1d0 entry_SYSCALL_64_after_hwframe+0x77/0x7fRIP 00330x7ff9f3114887RSP 002b00007ffecbacb458 EFLAGS 00000246 ORIG_RAX 0000000000000001RAX ffffffffffffffda RBX 000000000000000c RCX 00007ff9f3114887RDX 000000000000000c RSI 0000564494164e10 RDI 0000000000000001RBP 0000564494164e10 R08 00007ff9f31d1460 R09 000000007fffffffR10 0000000000000000 R11 0000000000000246 R12 000000000000000cR13 00007ff9f321b780 R14 00007ff9f3217600 R15 00007ff9f3216a00 Kernel panic - not syncing kernel panic_on_warn set ...CPU 8 PID 1011 Comm bash Kdump loaded Not tainted 6.9.0-rc3-next-20240410-00012-gdb69f219f4be #3Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.14.0-0-g155821a1990b-prebuilt.qemu.org 04/01/2014Call Trace panic+0x326/0x350 check_panic_on_warn+0x4f/0x50 __warn+0x98/0x190 report_bug+0x18e/0x1a0 handle_bug+0x3d/0x70 exc_invalid_op+0x18/0x70 asm_exc_invalid_op+0x1a/0x20RIP 0010__lock_acquire+0xccb/0x1ca0RSP 0018ffffa7a1c7fe3bd0 EFLAGS 00000082RAX 0000000000000000 RBX eb851eb853975fcf RCX ffffa1ce5fc1c9c8RDX 00000000ffffffd8 RSI 0000000000000027 RDI ffffa1ce5fc1c9c0RBP ffffa1c6865d3280 R08 ffffffffb0f570a8 R09 0000000000009ffbR10 0000000000000286 R11 ffffffffb0f2ad50 R12 ffffa1c6865d3d10R13 ffffa1c6865d3c70 R14 0000000000000000 R15 0000000000000004 lock_acquire+0xbe/0x2d0 _raw_spin_lock_irqsave+0x3a/0x60 hugepage_subpool_put_pages.part.0+0xe/0xc0 free_huge_folio+0x253/0x3f0 dissolve_free_huge_page+0x147/0x210 __page_handle_poison+0x9/0x70 memory_failure+0x4e6/0x8c0 hard_offline_page_store+0x55/0xa0 kernfs_fop_write_iter+0x12c/0x1d0 vfs_write+0x380/0x540 ksys_write+0x64/0xe0 do_syscall_64+0xbc/0x1d0 entry_SYSCALL_64_after_hwframe+0x77/0x7fRIP 00330x7ff9f3114887RSP 002b00007ffecbacb458 EFLAGS 00000246 ORIG_RAX 0000000000000001RAX ffffffffffffffda RBX 000000000000000c RCX 00007ff9f3114887RDX 000000000000000c RSI 0000564494164e10 RDI 0000000000000001RBP 0000564494164e10 R08 00007ff9f31d1460 R09 000000007fffffffR10 0000000000000000 R11 0000000000000246 R12 000000000000000cR13 00007ff9f321b780 R14 00007ff9f3217600 R15 00007ff9f3216a00 After git bisecting and digging into the code, I believe the root cause isthat _deferred_list field of folio is unioned with _hugetlb_subpool field.In __update_and_free_hugetlb_folio(), folio->_deferred_---truncated---",
    "keyphrases": {
        "rootcause": "",
        "weakness": "memory failure",
        "impact": "",
        "vector": "",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": "mm/hugetlb"
    }
}
