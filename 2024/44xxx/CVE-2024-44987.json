{
    "cveId": "CVE-2024-44987",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolvedipv6 prevent UAF in ip6_send_skb()syzbot reported an UAF in ip6_send_skb() [1]After ip6_local_out() has returned, we no longer can safelydereference rt, unless we hold rcu_read_lock().A similar issue has been fixed in commita688caa34beb (ipv6 take rcu lock in rawv6_send_hdrinc())Another potential issue in ip6_finish_output2() is handled in aseparate patch.[1] BUG KASAN slab-use-after-free in ip6_send_skb+0x18d/0x230 net/ipv6/ip6_output.c1964Read of size 8 at addr ffff88806dde4858 by task syz.1.380/6530CPU 1 UID 0 PID 6530 Comm syz.1.380 Not tainted 6.11.0-rc3-syzkaller-00306-gdf6cbc62cc9b #0Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 08/06/2024Call Trace __dump_stack lib/dump_stack.c93 [inline] dump_stack_lvl+0x241/0x360 lib/dump_stack.c119 print_address_description mm/kasan/report.c377 [inline] print_report+0x169/0x550 mm/kasan/report.c488 kasan_report+0x143/0x180 mm/kasan/report.c601 ip6_send_skb+0x18d/0x230 net/ipv6/ip6_output.c1964 rawv6_push_pending_frames+0x75c/0x9e0 net/ipv6/raw.c588 rawv6_sendmsg+0x19c7/0x23c0 net/ipv6/raw.c926 sock_sendmsg_nosec net/socket.c730 [inline] __sock_sendmsg+0x1a6/0x270 net/socket.c745 sock_write_iter+0x2dd/0x400 net/socket.c1160 do_iter_readv_writev+0x60a/0x890 vfs_writev+0x37c/0xbb0 fs/read_write.c971 do_writev+0x1b1/0x350 fs/read_write.c1018 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xf3/0x230 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7fRIP 00330x7f936bf79e79Code ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 40 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 3d 01 f0 ff ff 73 01 c3 48 c7 c1 a8 ff ff ff f7 d8 64 89 01 48RSP 002b00007f936cd7f038 EFLAGS 00000246 ORIG_RAX 0000000000000014RAX ffffffffffffffda RBX 00007f936c115f80 RCX 00007f936bf79e79RDX 0000000000000001 RSI 0000000020000040 RDI 0000000000000004RBP 00007f936bfe7916 R08 0000000000000000 R09 0000000000000000R10 0000000000000000 R11 0000000000000246 R12 0000000000000000R13 0000000000000000 R14 00007f936c115f80 R15 00007fff2860a7a8 Allocated by task 6530 kasan_save_stack mm/kasan/common.c47 [inline] kasan_save_track+0x3f/0x80 mm/kasan/common.c68 unpoison_slab_object mm/kasan/common.c312 [inline] __kasan_slab_alloc+0x66/0x80 mm/kasan/common.c338 kasan_slab_alloc include/linux/kasan.h201 [inline] slab_post_alloc_hook mm/slub.c3988 [inline] slab_alloc_node mm/slub.c4037 [inline] kmem_cache_alloc_noprof+0x135/0x2a0 mm/slub.c4044 dst_alloc+0x12b/0x190 net/core/dst.c89 ip6_blackhole_route+0x59/0x340 net/ipv6/route.c2670 make_blackhole net/xfrm/xfrm_policy.c3120 [inline] xfrm_lookup_route+0xd1/0x1c0 net/xfrm/xfrm_policy.c3313 ip6_dst_lookup_flow+0x13e/0x180 net/ipv6/ip6_output.c1257 rawv6_sendmsg+0x1283/0x23c0 net/ipv6/raw.c898 sock_sendmsg_nosec net/socket.c730 [inline] __sock_sendmsg+0x1a6/0x270 net/socket.c745 ____sys_sendmsg+0x525/0x7d0 net/socket.c2597 ___sys_sendmsg net/socket.c2651 [inline] __sys_sendmsg+0x2b0/0x3a0 net/socket.c2680 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xf3/0x230 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7fFreed by task 45 kasan_save_stack mm/kasan/common.c47 [inline] kasan_save_track+0x3f/0x80 mm/kasan/common.c68 kasan_save_free_info+0x40/0x50 mm/kasan/generic.c579 poison_slab_object+0xe0/0x150 mm/kasan/common.c240 __kasan_slab_free+0x37/0x60 mm/kasan/common.c256 kasan_slab_free include/linux/kasan.h184 [inline] slab_free_hook mm/slub.c2252 [inline] slab_free mm/slub.c4473 [inline] kmem_cache_free+0x145/0x350 mm/slub.c4548 dst_destroy+0x2ac/0x460 net/core/dst.c124 rcu_do_batch kernel/rcu/tree.c2569 [inline] rcu_core+0xafd/0x1830 kernel/rcu/tree.---truncated---",
    "keyphrases": {
        "rootcause": "Use-after-free in ip6_send_skb()",
        "weakness": "Dereferencing rt after ip6_local_out() without holding rcu_read_lock()",
        "impact": "Kernel crash due to use-after-free vulnerability",
        "vector": "Sending a crafted IPv6 packet can trigger the UAF.",
        "attacker": "Unspecified, but a local attacker could potentially trigger this vulnerability.",
        "product": "Linux Kernel",
        "version": "6.11.0-rc3",
        "component": "IPv6 networking stack"
    }
}
