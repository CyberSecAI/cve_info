{
    "cveId": "CVE-2024-49952",
    "version": "1.0.0",
    "timestamp": "2024-12-19T22:22:49.126128+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved netfilter nf_tables prevent nf_skb_duplicated corruption syzbot found that nf_dup_ipv4() or nf_dup_ipv6() could write per-cpu variable nf_skb_duplicated in an unsafe way [1]. Disabling preemption as hinted by the splat is not enough, we have to disable soft interrupts as well. [1] BUG using __this_cpu_write() in preemptible [00000000] code syz.4.282/6316 caller is nf_dup_ipv4+0x651/0x8f0 net/ipv4/netfilter/nf_dup_ipv4.c87 CPU 0 UID 0 PID 6316 Comm syz.4.282 Not tainted 6.11.0-rc7-syzkaller-00104-g7052622fccb1 #0 Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 08/06/2024 Call Trace __dump_stack lib/dump_stack.c93 [inline] dump_stack_lvl+0x241/0x360 lib/dump_stack.c119 check_preemption_disabled+0x10e/0x120 lib/smp_processor_id.c49 nf_dup_ipv4+0x651/0x8f0 net/ipv4/netfilter/nf_dup_ipv4.c87 nft_dup_ipv4_eval+0x1db/0x300 net/ipv4/netfilter/nft_dup_ipv4.c30 expr_call_ops_eval net/netfilter/nf_tables_core.c240 [inline] nft_do_chain+0x4ad/0x1da0 net/netfilter/nf_tables_core.c288 nft_do_chain_ipv4+0x202/0x320 net/netfilter/nft_chain_filter.c23 nf_hook_entry_hookfn include/linux/netfilter.h154 [inline] nf_hook_slow+0xc3/0x220 net/netfilter/core.c626 nf_hook+0x2c4/0x450 include/linux/netfilter.h269 NF_HOOK_COND include/linux/netfilter.h302 [inline] ip_output+0x185/0x230 net/ipv4/ip_output.c433 ip_local_out net/ipv4/ip_output.c129 [inline] ip_send_skb+0x74/0x100 net/ipv4/ip_output.c1495 udp_send_skb+0xacf/0x1650 net/ipv4/udp.c981 udp_sendmsg+0x1c21/0x2a60 net/ipv4/udp.c1269 sock_sendmsg_nosec net/socket.c730 [inline] __sock_sendmsg+0x1a6/0x270 net/socket.c745 ____sys_sendmsg+0x525/0x7d0 net/socket.c2597 ___sys_sendmsg net/socket.c2651 [inline] __sys_sendmmsg+0x3b2/0x740 net/socket.c2737 __do_sys_sendmmsg net/socket.c2766 [inline] __se_sys_sendmmsg net/socket.c2763 [inline] __x64_sys_sendmmsg+0xa0/0xb0 net/socket.c2763 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xf3/0x230 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7f RIP 00330x7f4ce4f7def9 Code ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 40 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 3d 01 f0 ff ff 73 01 c3 48 c7 c1 a8 ff ff ff f7 d8 64 89 01 48 RSP 002b00007f4ce5d4a038 EFLAGS 00000246 ORIG_RAX 0000000000000133 RAX ffffffffffffffda RBX 00007f4ce5135f80 RCX 00007f4ce4f7def9 RDX 0000000000000001 RSI 0000000020005d40 RDI 0000000000000006 RBP 00007f4ce4ff0b76 R08 0000000000000000 R09 0000000000000000 R10 0000000000000000 R11 0000000000000246 R12 0000000000000000 R13 0000000000000000 R14 00007f4ce5135f80 R15 00007ffd4cbc6d68",
    "keyphrases": {
        "rootcause": "nf_dup_ipv4() or nf_dup_ipv6() could write per-cpu variable nf_skb_duplicated in an unsafe way",
        "weakness": "The code was writing to a per-CPU variable without disabling soft interrupts, leading to potential race conditions",
        "impact": "Corruption of the nf_skb_duplicated variable",
        "vector": "Network packet processing",
        "attacker": "Unspecified, likely triggered by network traffic",
        "product": "Linux Kernel",
        "version": "6.11.0-rc7-syzkaller-00104-g7052622fccb1",
        "component": "netfilter nf_tables"
    }
}
