{
  "cveId": "CVE-2024-26937",
  "version": "1.0.0",
  "timestamp": "2024-12-19T22:22:49.126128+00:00",
  "description": "In the Linux kernel, the following vulnerability has been resolveddrm/i915/gt Reset queue_priority_hint on parkingOriginally, with strict in order execution, we could complete executiononly when the queue was empty. Preempt-to-busy allows replacement of anactive request that may complete before the preemption is processed byHW. If that happens, the request is retired from the queue, but thequeue_priority_hint remains set, preventing direct submission untilafter the next CS interrupt is processed.This preempt-to-busy race can be triggered by the heartbeat, which willalso act as the power-management barrier and upon completion allow us toidle the HW. We may process the completion of the heartbeat, and beginparking the engine before the CS event that restores thequeue_priority_hint, causing us to fail the assertion that it is MIN.[ 166.210729] __engine_park283 GEM_BUG_ON(engine->sched_engine->queue_priority_hint != (-((int)(~0U >> 1)) - 1))[ 166.210781] Dumping ftrace buffer[ 166.210795] ---------------------------------...[ 167.302811] drm_fdin-1097 2..s1. 165741070us trace_ports 00000002.0 rcs0 promote { ccid20 12172 prio 0 }[ 167.302861] drm_fdin-1097 2d.s2. 165741072us execlists_submission_tasklet 00000002.0 rcs0 preempting last=12172, prio=0, hint=2147483646[ 167.302928] drm_fdin-1097 2d.s2. 165741072us __i915_request_unsubmit 00000002.0 rcs0 fence 12172, current 0[ 167.302992] drm_fdin-1097 2d.s2. 165741073us __i915_request_submit 00000002.0 rcs0 fence 34660, current 4659[ 167.303044] drm_fdin-1097 2d.s1. 165741076us execlists_submission_tasklet 00000002.0 rcs0 context3 schedule-in, ccid40[ 167.303095] drm_fdin-1097 2d.s1. 165741077us trace_ports 00000002.0 rcs0 submit { ccid40 34660* prio 2147483646 }[ 167.303159] kworker/-89 11..... 165741139us i915_request_retire.part.0 00000002.0 rcs0 fence c902, current 2[ 167.303208] kworker/-89 11..... 165741148us __intel_context_do_unpin 00000002.0 rcs0 contextc90 unpin[ 167.303272] kworker/-89 11..... 165741159us i915_request_retire.part.0 00000002.0 rcs0 fence 12172, current 2[ 167.303321] kworker/-89 11..... 165741166us __intel_context_do_unpin 00000002.0 rcs0 context1217 unpin[ 167.303384] kworker/-89 11..... 165741170us i915_request_retire.part.0 00000002.0 rcs0 fence 34660, current 4660[ 167.303434] kworker/-89 11d..1. 165741172us __intel_context_retire 00000002.0 rcs0 context1216 retire runtime { total56028ns, avg56028ns }[ 167.303484] kworker/-89 11..... 165741198us __engine_park 00000002.0 rcs0 parked[ 167.303534] -0 5d.H3. 165741207us execlists_irq_handler 00000002.0 rcs0 semaphore yield 00000040[ 167.303583] kworker/-89 11..... 165741397us __intel_context_retire 00000002.0 rcs0 context1217 retire runtime { total325575ns, avg0ns }[ 167.303756] kworker/-89 11..... 165741777us __intel_context_retire 00000002.0 rcs0 contextc90 retire runtime { total0ns, avg0ns }[ 167.303806] kworker/-89 11..... 165742017us __engine_park __engine_park283 GEM_BUG_ON(engine->sched_engine->queue_priority_hint != (-((int)(~0U >> 1)) - 1))[ 167.303811] ---------------------------------[ 167.304722] ------------[ cut here ]------------[ 167.304725] kernel BUG at drivers/gpu/drm/i915/gt/intel_engine_pm.c283![ 167.304731] invalid opcode 0000",
  "keyphrases": {
    "rootcause": [
      "A race condition exists in the handling of preempt-to-busy scenarios where a request can be retired from the queue while the queue_priority_hint remains set",
      "leading to an assertion failure when parking the engine. The race occurs between the preemption of a request",
      "its retirement",
      "and the subsequent CS event that restores the queue_priority_hint."
    ],
    "weakness": "Improper synchronization and handling of the queue_priority_hint during preempt-to-busy scenarios in the Intel i915 graphics driver.",
    "impact": [
      "Kernel panic and system instability due to assertion failure during engine parking.",
      "kernel BUG"
    ],
    "vector": [
      "The vulnerability can be triggered by the heartbeat mechanism which acts as a power-management barrier",
      "leading to a race condition during preemption."
    ],
    "attacker": "An attacker could potentially exploit this by triggering a specific sequence of graphics operations that trigger this preempt-to-busy race condition.",
    "product": "Linux kernel",
    "version": "Likely prior to the fix which is not specified but can be inferred to be fixed recently since this is a bug report",
    "component": "drm/i915/gt (Intel Graphics Driver)"
  },
  "mitreTechnicalImpacts": []
}