{
    "cveId": "CVE-2024-26962",
    "version": "1.0.0",
    "timestamp": "2024-12-17T08:36:27.567979+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolveddm-raid456, md/raid456 fix a deadlock for dm-raid456 while io concurrent with reshapeFor raid456, if reshape is still in progress, then IO across reshapeposition will wait for reshape to make progress. However, for dm-raid,in following cases reshape will never make progress hence IO will hang1) the array is read-only2) MD_RECOVERY_WAIT is set3) MD_RECOVERY_FROZEN is setAfter commit c467e97f079f (md/raid6 use valid sector values to determineif an I/O should wait on the reshape) fix the problem that IO acrossreshape position doesnt wait for reshape, the dm-raid testshell/lvconvert-raid-reshape.sh start to hang[root@fedora ~]# cat /proc/979/stack[] wait_woken+0x7d/0x90[] raid5_make_request+0x929/0x1d70 [raid456][] md_handle_request+0xc2/0x3b0 [md_mod][] raid_map+0x2c/0x50 [dm_raid][] __map_bio+0x251/0x380 [dm_mod][] dm_submit_bio+0x1f0/0x760 [dm_mod][] __submit_bio+0xc2/0x1c0[] submit_bio_noacct_nocheck+0x17f/0x450[] submit_bio_noacct+0x2bc/0x780[] submit_bio+0x70/0xc0[] mpage_readahead+0x169/0x1f0[] blkdev_readahead+0x18/0x30[] read_pages+0x7c/0x3b0[] page_cache_ra_unbounded+0x1ab/0x280[] force_page_cache_ra+0x9e/0x130[] page_cache_sync_ra+0x3b/0x110[] filemap_get_pages+0x143/0xa30[] filemap_read+0xdc/0x4b0[] blkdev_read_iter+0x75/0x200[] vfs_read+0x272/0x460[] ksys_read+0x7a/0x170[] __x64_sys_read+0x1c/0x30[] do_syscall_64+0xc6/0x230[] entry_SYSCALL_64_after_hwframe+0x6c/0x74This is because reshape cant make progress.For md/raid, the problem doesnt exist because register new sync_threaddoesnt rely on the IO to be done any more1) If array is read-only, it can switch to read-write by ioctl/sysfs2) md/raid never set MD_RECOVERY_WAIT3) If MD_RECOVERY_FROZEN is set, mddev_suspend() doesnt hold reconfig_mutex, hence it can be cleared and reshape can continue by sysfs api sync_action.However, Im not sure yet how to avoid the problem in dm-raid yet. Thispatch on the one hand make sure raid_message() cant changesync_thread() through raid_message() after presuspend(), on the otherhand detect the above 3 cases before wait for IO do be done indm_suspend(), and let dm-raid requeue those IO.",
    "keyphrases": {
        "rootcause": "deadlock in dm-raid456",
        "weakness": "",
        "impact": "hang",
        "vector": "io concurrent with reshape",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": "dm-raid456, md/raid456"
    }
}
