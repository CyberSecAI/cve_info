{
    "cveId": "CVE-2024-50114",
    "version": "1.0.0",
    "timestamp": "2024-12-17T08:36:27.567979+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved KVM arm64 Unregister redistributor for failed vCPU creation Alex reports that syzkaller has managed to trigger a use-after-free when tearing down a VM BUG KASAN slab-use-after-free in kvm_put_kvm+0x300/0xe68 virt/kvm/kvm_main.c5769 Read of size 8 at addr ffffff801c6890d0 by task syz.3.2219/10758 CPU 3 UID 0 PID 10758 Comm syz.3.2219 Not tainted 6.11.0-rc6-dirty #64 Hardware name linux,dummy-virt (DT) Call trace dump_backtrace+0x17c/0x1a8 arch/arm64/kernel/stacktrace.c317 show_stack+0x2c/0x3c arch/arm64/kernel/stacktrace.c324 __dump_stack lib/dump_stack.c93 [inline] dump_stack_lvl+0x94/0xc0 lib/dump_stack.c119 print_report+0x144/0x7a4 mm/kasan/report.c377 kasan_report+0xcc/0x128 mm/kasan/report.c601 __asan_report_load8_noabort+0x20/0x2c mm/kasan/report_generic.c381 kvm_put_kvm+0x300/0xe68 virt/kvm/kvm_main.c5769 kvm_vm_release+0x4c/0x60 virt/kvm/kvm_main.c1409 __fput+0x198/0x71c fs/file_table.c422 ____fput+0x20/0x30 fs/file_table.c450 task_work_run+0x1cc/0x23c kernel/task_work.c228 do_notify_resume+0x144/0x1a0 include/linux/resume_user_mode.h50 el0_svc+0x64/0x68 arch/arm64/kernel/entry-common.c169 el0t_64_sync_handler+0x90/0xfc arch/arm64/kernel/entry-common.c730 el0t_64_sync+0x190/0x194 arch/arm64/kernel/entry.S598 Upon closer inspection, it appears that we do not properly tear down the MMIO registration for a vCPU that fails creation late in the game, e.g. a vCPU w/ the same ID already exists in the VM. It is important to consider the context of commit that introduced this bug by moving the unregistration out of __kvm_vgic_vcpu_destroy(). That change correctly sought to avoid an srcu v. config_lock inversion by breaking up the vCPU teardown into two parts, one guarded by the config_lock. Fix the use-after-free while avoiding lock inversion by adding a special-cased unregistration to __kvm_vgic_vcpu_destroy(). This is safe because failed vCPUs are torn down outside of the config_lock.",
    "keyphrases": {
        "rootcause": "",
        "weakness": "use-after-free",
        "impact": "",
        "vector": "",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": "KVM arm64"
    }
}
