{
    "cveId": "CVE-2025-21858",
    "version": "1.0.0",
    "timestamp": "2025-07-04T16:12:41.853043+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved geneve Fix use-after-free in geneve_find_dev(). syzkaller reported a use-after-free in geneve_find_dev() [0] without repro. geneve_configure() links struct geneve_dev.next to net_generic(net, geneve_net_id)->geneve_list. The net here could differ from dev_net(dev) if IFLA_NET_NS_PID, IFLA_NET_NS_FD, or IFLA_TARGET_NETNSID is set. When dev_net(dev) is dismantled, geneve_exit_batch_rtnl() finally calls unregister_netdevice_queue() for each dev in the netns, and later the dev is freed. However, its geneve_dev.next is still linked to the backend UDP socket netns. Then, use-after-free will occur when another geneve dev is created in the netns. Lets call geneve_dellink() instead in geneve_destroy_tunnels(). [0] BUG KASAN slab-use-after-free in geneve_find_dev drivers/net/geneve.c1295 [inline] BUG KASAN slab-use-after-free in geneve_configure+0x234/0x858 drivers/net/geneve.c1343 Read of size 2 at addr ffff000054d6ee24 by task syz.1.4029/13441 CPU 1 UID 0 PID 13441 Comm syz.1.4029 Not tainted 6.13.0-g0ad9617c78ac #24 dc35ca22c79fb82e8e7bc5c9c9adafea898b1e3d Hardware name linux,dummy-virt (DT) Call trace show_stack+0x38/0x50 arch/arm64/kernel/stacktrace.c466 (C) __dump_stack lib/dump_stack.c94 [inline] dump_stack_lvl+0xbc/0x108 lib/dump_stack.c120 print_address_description mm/kasan/report.c378 [inline] print_report+0x16c/0x6f0 mm/kasan/report.c489 kasan_report+0xc0/0x120 mm/kasan/report.c602 __asan_report_load2_noabort+0x20/0x30 mm/kasan/report_generic.c379 geneve_find_dev drivers/net/geneve.c1295 [inline] geneve_configure+0x234/0x858 drivers/net/geneve.c1343 geneve_newlink+0xb8/0x128 drivers/net/geneve.c1634 rtnl_newlink_create+0x23c/0x868 net/core/rtnetlink.c3795 __rtnl_newlink net/core/rtnetlink.c3906 [inline] rtnl_newlink+0x1054/0x1630 net/core/rtnetlink.c4021 rtnetlink_rcv_msg+0x61c/0x918 net/core/rtnetlink.c6911 netlink_rcv_skb+0x1dc/0x398 net/netlink/af_netlink.c2543 rtnetlink_rcv+0x34/0x50 net/core/rtnetlink.c6938 netlink_unicast_kernel net/netlink/af_netlink.c1322 [inline] netlink_unicast+0x618/0x838 net/netlink/af_netlink.c1348 netlink_sendmsg+0x5fc/0x8b0 net/netlink/af_netlink.c1892 sock_sendmsg_nosec net/socket.c713 [inline] __sock_sendmsg net/socket.c728 [inline] ____sys_sendmsg+0x410/0x6f8 net/socket.c2568 ___sys_sendmsg+0x178/0x1d8 net/socket.c2622 __sys_sendmsg net/socket.c2654 [inline] __do_sys_sendmsg net/socket.c2659 [inline] __se_sys_sendmsg net/socket.c2657 [inline] __arm64_sys_sendmsg+0x12c/0x1c8 net/socket.c2657 __invoke_syscall arch/arm64/kernel/syscall.c35 [inline] invoke_syscall+0x90/0x278 arch/arm64/kernel/syscall.c49 el0_svc_common+0x13c/0x250 arch/arm64/kernel/syscall.c132 do_el0_svc+0x54/0x70 arch/arm64/kernel/syscall.c151 el0_svc+0x4c/0xa8 arch/arm64/kernel/entry-common.c744 el0t_64_sync_handler+0x78/0x108 arch/arm64/kernel/entry-common.c762 el0t_64_sync+0x198/0x1a0 arch/arm64/kernel/entry.S600 Allocated by task 13247 kasan_save_stack mm/kasan/common.c47 [inline] kasan_save_track+0x30/0x68 mm/kasan/common.c68 kasan_save_alloc_info+0x44/0x58 mm/kasan/generic.c568 poison_kmalloc_redzone mm/kasan/common.c377 [inline] __kasan_kmalloc+0x84/0xa0 mm/kasan/common.c394 kasan_kmalloc include/linux/kasan.h260 [inline] __do_kmalloc_node mm/slub.c4298 [inline] __kmalloc_node_noprof+0x2a0/0x560 mm/slub.c4304 __kvmalloc_node_noprof+0x9c/0x230 mm/util.c645 alloc_netdev_mqs+0xb8/0x11a0 net/core/dev.c11470 rtnl_create_link+0x2b8/0xb50 net/core/rtnetlink.c3604 rtnl_newlink_create+0x19c/0x868 net/core/rtnetlink.c3780 __rtnl_newlink net/core/rtnetlink.c3906 [inline] rtnl_newlink+0x1054/0x1630 net/core/rtnetlink.c4021 rtnetlink_rcv_msg+0x61c/0x918 net/core/rtnetlink.c6911 netlink_rcv_skb+0x1dc/0x398 net/netlink/af_netlink.c2543 rtnetlink_rcv+0x34/0x50 net/core/rtnetlink.c6938 netlink_unicast_kernel net/netlink/af_n ---truncated---",
    "keyphrases": {
        "rootcause": "use-after-free",
        "weakness": "",
        "impact": "",
        "vector": "",
        "attacker": "syzkaller",
        "product": "Linux kernel",
        "version": "6.13.0-g0ad9617c78ac",
        "component": "geneve_find_dev"
    }
}
