{
    "cveId": "CVE-2025-21677",
    "version": "1.0.0",
    "timestamp": "2025-07-04T16:12:41.853043+00:00",
    "description": "In the Linux kernel, the following vulnerability has been resolved pfcp Destroy device along with udp sockets netns dismantle. pfcp_newlink() links the device to a list in dev_net(dev) instead of net, where a udp tunnel socket is created. Even when net is removed, the device stays alive on dev_net(dev). Then, removing net triggers the splat below. [0] In this example, pfcp0 is created in ns2, but the udp socket is created in ns1. ip netns add ns1 ip netns add ns2 ip -n ns1 link add netns ns2 name pfcp0 type pfcp ip netns del ns1 Lets link the device to the sockets netns instead. Now, pfcp_net_exit() needs another netdev iteration to remove all pfcp devices in the netns. pfcp_dev_list is not used under RCU, so the list API is converted to the non-RCU variant. pfcp_net_exit() can be converted to .exit_batch_rtnl() in net-next. [0] ref_tracker net notrefcnt@00000000128b34dc has 1/1 users at sk_alloc (./include/net/net_namespace.h345 net/core/sock.c2236) inet_create (net/ipv4/af_inet.c326 net/ipv4/af_inet.c252) __sock_create (net/socket.c1558) udp_sock_create4 (net/ipv4/udp_tunnel_core.c18) pfcp_create_sock (drivers/net/pfcp.c168) pfcp_newlink (drivers/net/pfcp.c182 drivers/net/pfcp.c197) rtnl_newlink (net/core/rtnetlink.c3786 net/core/rtnetlink.c3897 net/core/rtnetlink.c4012) rtnetlink_rcv_msg (net/core/rtnetlink.c6922) netlink_rcv_skb (net/netlink/af_netlink.c2542) netlink_unicast (net/netlink/af_netlink.c1321 net/netlink/af_netlink.c1347) netlink_sendmsg (net/netlink/af_netlink.c1891) ____sys_sendmsg (net/socket.c711 net/socket.c726 net/socket.c2583) ___sys_sendmsg (net/socket.c2639) __sys_sendmsg (net/socket.c2669) do_syscall_64 (arch/x86/entry/common.c52 arch/x86/entry/common.c83) entry_SYSCALL_64_after_hwframe (arch/x86/entry/entry_64.S130) WARNING CPU 1 PID 11 at lib/ref_tracker.c179 ref_tracker_dir_exit (lib/ref_tracker.c179) Modules linked in CPU 1 UID 0 PID 11 Comm kworker/u160 Not tainted 6.13.0-rc5-00147-g4c1224501e9d #5 Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014 Workqueue netns cleanup_net RIP 0010ref_tracker_dir_exit (lib/ref_tracker.c179) Code 00 00 00 fc ff df 4d 8b 26 49 bd 00 01 00 00 00 00 ad de 4c 39 f5 0f 85 df 00 00 00 48 8b 74 24 08 48 89 df e8 a5 cc 12 02 90 0b 90 48 8d 6b 44 be 04 00 00 00 48 89 ef e8 80 de 67 ff 48 89 RSP 0018ff11000007f3fb60 EFLAGS 00010286 RAX 00000000000020ef RBX ff1100000d6481e0 RCX 1ffffffff0e40d82 RDX 0000000000000000 RSI 0000000000000000 RDI ffffffff8423ee3c RBP ff1100000d648230 R08 0000000000000001 R09 fffffbfff0e395af R10 0000000000000001 R11 0000000000000000 R12 ff1100000d648230 R13 dead000000000100 R14 ff1100000d648230 R15 dffffc0000000000 FS 0000000000000000(0000) GSff1100006ce80000(0000) knlGS0000000000000000 CS 0010 DS 0000 ES 0000 CR0 0000000080050033 CR2 00005620e1363990 CR3 000000000eeb2002 CR4 0000000000771ef0 DR0 0000000000000000 DR1 0000000000000000 DR2 0000000000000000 DR3 0000000000000000 DR6 00000000fffe07f0 DR7 0000000000000400 PKRU 55555554 Call Trace ? __warn (kernel/panic.c748) ? ref_tracker_dir_exit (lib/ref_tracker.c179) ? report_bug (lib/bug.c201 lib/bug.c219) ? handle_bug (arch/x86/kernel/traps.c285) ? exc_invalid_op (arch/x86/kernel/traps.c309 (discriminator 1)) ? asm_exc_invalid_op (./arch/x86/include/asm/idtentry.h621) ? _raw_spin_unlock_irqrestore (./arch/x86/include/asm/irqflags.h42 ./arch/x86/include/asm/irqflags.h97 ./arch/x86/include/asm/irqflags.h155 ./include/linux/spinlock_api_smp.h151 kernel/locking/spinlock.c194) ? ref_tracker_dir_exit (lib/ref_tracker.c179) ? __pfx_ref_tracker_dir_exit (lib/ref_tracker.c158) ? kfree (mm/slub.c4613 mm/slub.c4761) net_free (net/core/net_namespace.c476 net/core/net_namespace.c467) cleanup_net (net/cor ---truncated---",
    "keyphrases": {
        "rootcause": "",
        "weakness": "",
        "impact": "splat",
        "vector": "",
        "attacker": "",
        "product": "Linux kernel",
        "version": "",
        "component": "netns dismantle"
    }
}
